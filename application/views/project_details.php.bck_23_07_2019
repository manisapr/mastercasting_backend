<?php //$starttime = microtime(true); ?>
<!-- BEGIN HEADER -->
<?php include 'inc/header.php'; ?>
<?php date_default_timezone_set('America/Chicago'); ?>

<?php $designation_id = $this->db->get_where('user', ['id' => $this->session->userdata('user_id')])->row()->designation_id; ?>

<script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
 
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />



<!-- styles -->
    <style>
        .explorer-frame .file-preview-html {
            display: flex;
            border: 1px solid #ddd;
            padding: 8px;
            overflow: none!important; 
        }
        .proj_img_chk{
            margin: 15px 5px 0 0!important;
            line-height: normal!important;
        }
        #kvFileinputModal img{
            width: 100%!important;
        }
        .theme-explorer-fas .file-actions-cell{
            width: 140px!important;
        }
        label{
            font-weight: bold;
        }
        .criticalDates a{
            background-color: #E26A6A !important;
        }
        .rushDates a{
            background-color: #ffd325!important;
        }
        .standardDates a{
            background-color: #36D7B7 !important;
        }
        .ui-state-active, .ui-widget-content .ui-state-active, .ui-widget-header .ui-state-active, a.ui-button:active, .ui-button:active, .ui-button.ui-state-active:hover {
            border: 1px solid #003eff!important;
            background: #007fff!important;
            font-weight: normal!important;
            color: #ffffff!important;
        }
    </style>

<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- BEGIN HEADER & CONTENT DIVIDER -->
    <div class="clearfix"> </div>
    <!-- END HEADER & CONTENT DIVIDER -->
        <!-- BEGIN CONTAINER -->
        <div class="page-container" id="project_details_container">
            <!-- BEGIN SIDEBAR -->
            <?php include 'inc/sidebar.php'; ?>
            <!-- END SIDEBAR -->
            <!-- BEGIN CONTENT -->
            <div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                    <!-- BEGIN PAGE HEADER-->
                    
                    <!-- BEGIN PAGE BAR -->
                    <div class="page-bar">
                        <ul class="page-breadcrumb">
                            <li> <a href="<?php echo base_url()?>">Home</a> <i class="fa fa-circle"></i> </li>
                            <li> <a href="<?php echo base_url('projects/all_projects')?>">Projects</a> <i class="fa fa-circle"></i> </li>
                            <li> <span>Projects Details</span> </li>
                        </ul>
                    </div>
                    <!-- END PAGE BAR -->
                    <!-- BEGIN PAGE TITLE-->
                    <h1 class="page-title">
                        Project Details - J<?php echo $project->project_id ?> 
                        <?php if(in_array($designation_id, [1,5,7,6])): ?>
                       <!--  <?php if($project_details->request_estimate == 1 || $project_details->estimated_price > 0): ?>
                            <?php if($project_details->estimated_approve == 1): ?>
                            <span style="margin-right: 5px" class="caption-subject bold uppercase pull-right font-green-meadow"><i class="fa fa-check font-green-meadow"></i>Approved</span>
                            <?php else: ?>
                            <a class="btn btn-circle bold uppercase pull-right green-meadow" href="<?php echo base_url('project/approve_estimate/'.$project->project_id) ?>">Approve</a>
                            <?php endif; ?>
                        <?php endif; ?> -->
                        <?php endif; ?>
                    </h1>
                    <!-- End PAGE TITLE-->
                    <div class="row">
                        <div class="col-md-12">
                            <!-- BEGIN EXAMPLE TABLE PORTLET-->
                            <div class="portlet light bordered">

                                <div class="portlet-title">
                                    <div class="caption font-dark">
                                        <span class="caption-subject bold uppercase"><i class="icon-briefcase font-dark"></i> PO - <?= $project_details->po ?></span>
                                        <?php if(!in_array($designation_id, [9])): ?>
                                        <span class="caption-subject bold uppercase">
                                            Client - <?php 
                                                        if($project->asign_user != 0) {
                                                            $user = $this->db->get_where('user',['id' => $project->asign_user])->row();
                                                            if($user->designation_id != 7)
                                                                echo $user->name;
                                                            else
                                                                echo $user->company_name.' ('.$user->name.')';
                                                        }
                                                        ?>
                                                
                                        </span>
                                        <span class="caption-subject bold uppercase text-center">Added By - <?php echo $project->assign_by == 0 ? '' : $this->db->get_where('user', ['id' => $project->assign_by])->row()->name  ?></span>
                                        <?php if($project->asign_user != 0): ?>
                                        <?php $representative = $this->db->get_where('user', ['id' => $project->asign_user])->row()->representative; ?>
                                        <span class="caption-subject bold uppercase text-center">Sales Rep - <?php echo is_null($representative) ? '' : $this->db->get_where('user', ['id' => $representative])->row()->name  ?></span>
                                        <?php endif; ?>

                                        <?php endif; ?>
                                        <span class="caption-subject bold uppercase text-right">Status - <span  class="badge badge-secondary"><?php echo $project_details->type ?></span></span>
                                    </div>
                                    <div class="caption font-dark">
                                        
                                    </div>
                                    <!-- <br> -->

                                    <!-- <div class="row">
                                        <div class="col-md-12 text-right" style="margin-bottom: 20px;margin-top: 10px">
                                            <button class="btn btn-sm btn-default" data-toggle="modal" data-target="#myModal">Gallery</button>
                                            <?php if($client_approval): ?>
                                            <a href="#project_print" id="print_job_sheet" class="btn btn-sm btn-default">Print Job Sheet</a>
                                            <a target="_blank" href="<?php echo base_url('Project_controller/print_job_label/'.$this->uri->segment(3))?>" class="btn btn-sm btn-default">Print Job Label</a>
                                            <?php endif; ?>
                                        </div>
                                    </div> -->
                                </div>
                                        
                                
                                        
                                <div class="portlet-body">
                                   
                                    <div class="btn-toolbar margin-bottom-10">

                                        <div class="btn-group pull-right btn-group-devided">

                                            <?php 
                                            switch ($project_details->cad_progress) {
                                                case 'On Hold':
                                                    $cad_progress_color = 'red-sunglo';
                                                    # code...
                                                    break;
                                                case 'Ready':
                                                    $cad_progress_color = 'green-meadow';
                                                    break;
                                                case 'In Progress':
                                                    $cad_progress_color = 'blue-madison';
                                                    break;
                                                case '3D Printing Only':
                                                    $cad_progress_color = 'blue-madison';
                                                    break;
                                                
                                            }
                                             ?>
                                            <?php if($client_approval): ?>
                                            <span class="btn btn-sm btn-circle <?php echo $cad_progress_color ?>">Cad Progression - <?php echo $project_details->cad_progress ?></span>
                                            <?php endif; ?>
                                            <?php if(in_array($designation_id, [9])): ?>
                                            <div class="btn-group btn-group-devided">
                                                <button type="button" class="btn btn-circle grey-salsa btn-sm dropdown-toggle" data-close-others="true" data-toggle="dropdown" <?php echo $cad_check ? '' : 'disabled' ?>>
                                                Cad Progress <span class="caret"></span></button>
                                                <ul class="dropdown-menu" role="menu">
                                                    <li>
                                                        <a href="<?php echo base_url('Project_controller/change_cad_progress/'.$project->project_id.'/hold')?>">On Hold</a>
                                                    </li>
                                                    <li>
                                                        <a href="<?php echo base_url('Project_controller/change_cad_progress/'.$project->project_id.'/in_progress')?>">In Progress</a>
                                                    </li>
                                                    <li>
                                                        <a href="<?php echo base_url('Project_controller/change_cad_progress/'.$project->project_id.'/3d_printing')?>">3D Printing Only</a>
                                                    </li>
                                                    <li>
                                                        <a href="<?php echo base_url('Project_controller/change_cad_progress/'.$project->project_id.'/ready')?>">Ready</a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <?php endif; ?>
                                            <?php if(!in_array($designation_id, [5,7,9])): ?>
                                            <div class="btn-group btn-group-devided">
                                                <button type="button" class="btn btn-circle grey-salsa btn-sm dropdown-toggle" data-close-others="true" data-toggle="dropdown">
                                                Options <span class="caret"></span></button>
                                                <ul class="dropdown-menu" role="menu">
                                                    <li>
                                                        <a target="_blank" href="<?php echo base_url('Project_controller/print_job_label/'.$this->uri->segment(3))?>">Print Job Label</a>
                                                    </li>
                                                    <li>
                                                        <a href="#project_print" id="print_job_sheet">Print Job Sheet</a>
                                                    </li>
                                                    <li>
                                                        <a href="#project_vendor_envelope" id="pro_vndr_envlp_lnk">Vendor envelepe</a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <?php endif; ?>
                                            
                                            <?php if($client_approval): ?>
                                            <button type="button" class="btn  btn-circle grey-salsa btn-sm" data-toggle="modal" data-target="#myModal">Gallery</button>
                                            <?php endif; ?>
                                        </div>
                                    </div>
                                    
                                    <!-- disposition -->
                                    <?php if(!in_array($designation_id, [9])): ?> <!-- cad team cannot see -->
                                    <div class="row step-line" id="project_disposition_steps">
                                        <div class="col-md-2">
                                            <span class="caption-subject bold font-dark">8 Steps Disposition</span>
                                            <!-- <div class="font-dark bold uppercase" style="display: inline;"></div>  -->
                                           <!--  <?php if($client_approval): ?>
                                            <button id="reset_all_disposition" value="<?php //echo $project->project_id ?>" class="btn btn-default" style="margin-left: 20px">Reset disposition</button>

                                            <?php endif; ?> -->
                                        </div>
                                        <?php if($client_approval): ?>
                                        <div class="col-md-4">
                                            <div class="btn-group btn-group-devided">
                                                <button id="reset_all_disposition" value="<?php echo $project->project_id ?>" class="btn btn-circle red-sunglo btn-sm" style="margin-left: 20px">Reset disposition</button>

                                                <a class="btn btn-circle grey-salsa btn-sm dropdown-toggle" data-toggle="dropdown" href="javascript:;" aria-expanded="true"> More
                                                    <i class="fa fa-angle-down"></i>
                                                </a>
                                                <ul class="dropdown-menu">
                                                    <li>
                                                        <a class="disposition_more" data-value='wax' href="javascript:;"> Wax Only </a>
                                                    </li>
                                                    <li>
                                                        <a class="disposition_more" data-value='casting' href="javascript:;"> Casting Only </a>
                                                    </li>
                                                    <li>
                                                        <a class="disposition_more" data-value='repairs' href="javascript:;"> Repairs </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <?php endif; ?>
                                        <div class="col-md-12">
                                            <div id="project_dispositions_main"><?php echo ($project_dispositions) ?></div>
                                        </div>
                                    </div>
                                    <?php endif; ?>
                                    <!-- end disposition -->

                                    <!-- internal disposition -->
                                    <?php if ($client_approval) : ?>
                                    <?php if(!in_array($designation_id, [9])): ?> <!-- cad team cannot see -->
                                    <div class="row step-line">
                                        <div class="col-md-4">
                                            <span class="caption-subject bold font-dark">8 Steps Internal Disposition</span>
                                        </div>
                                        <div class="col-md-12">
                                            <div  id="project_disposition_internal_steps"><?php echo $project_dispositions_internal ?></div>
                                        </div>
                                    </div>
                                    <?php endif; ?>
                                    <?php endif; ?>
                                    <!-- end internal disposition -->


                                    <form id="" class="form-horizontal" action="<?php echo base_url('Project_controller/update_project_action/'.$this->uri->segment(3))?>" method="POST" onkeydown="return event.key != 'Enter';">
                                        <!-- == -->
                                        <div class="form msg-frm">
                                            <!-- END TASK HEAD -->
                                            <!-- Created at -->
                                            <div class="form-group">
                                                <div class="col-md-12">
                                                    <label for="">Created At</label>
                                                    <input type="text" class="form-control todo-taskbody-tasktitle" value="<?= date_convert(date('d-m-Y H:i:s', strtotime($project_details->created_at)), 'd M, Y h:i A'); ?>" disabled>
                                                </div>
                                            </div>

                                            <!-- Type -->
                                            <?php if(!in_array($designation_id, [9])): ?>
                                            <div class="form-group">
                                                <div class="col-md-12">
                                                    <label for="">Project Status</label>
                                                    <select name="project[type]" class="form-control" <?php echo !$client_approval ? 'disabled' : '' ?>>
                                                        <option value="proposal" <?= $project_details->type == 'proposal' ? 'selected' : '' ?>>Proposal</option>
                                                        <option value="live" <?= $project_details->type == 'live' ? 'selected' : '' ?>>Live</option>
                                                        <option value="completed" <?= $project_details->type == 'completed' ? 'selected' : '' ?>>Completed</option>
                                                        <option value="cancelled" <?= $project_details->type == 'cancelled' ? 'selected' : '' ?>>Cancelled</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <?php endif; ?>


                                            <!-- Manager -->
                                           <!--  <div class="form-group">
                                                <div class="col-md-12">
                                                    <label for="">Project Manager</label>
                                                    <select name="project[assignee]" class="form-control">
                                                        <option value="">Set Manager</option>
                                                        <?php foreach ($manager as $key) : ?>
                                                        <option value="<?= $key->id ?>"
                                                            <?= $project->manager_category == $key->id ? 'selected' : ''?>>
                                                            <?= $key->name ?>
                                                        </option>
                                                        <?php endforeach; ?>
                                                    </select>
                                                </div>
                                            </div> -->

                                            <!-- Client -->
                                            <!-- <div class="form-group">
                                                <div class="col-md-12">
                                                    <select name="project[assignee]" class="form-control">
                                                        <option value="">Set Client</option>
                                                        <?php foreach ($client as $key) : ?>
                                                        <option value="<?= $key->id ?>"
                                                            <?= $project->asign_user == $key->id ? 'selected' : ''?>>
                                                            <?= $key->name ?>
                                                        </option>
                                                        <?php endforeach; ?>
                                                    </select>
                                                </div>
                                            </div> -->

                                            <!-- Asignee -->
                                            <?php if($client_approval): ?>
                                            <?php if(!in_array($designation_id, [9])): ?>
                                            <?php $project_assignee = explode(',', $project_details->assignee); ?>
                                            <div class="form-group">
                                                <div class="col-md-12">
                                                    <label for="">Project Assignee</label>
                                                    <select id="project_assignee" name="project[assignee][]" multiple="multiple" class="form-control">
                                                        <option value="">Set Assignee</option>
                                                        <?php foreach ($assignee as $key) : ?>
                                                        <option data-des="<?= $key->designation_id ?>" value="<?= $key->id ?>"
                                                            <?= in_array($key->id, $project_assignee) ? 'selected' : ''?>><?= $key->name.' - '. $this->db->get_where('designation', ['designation_id' => $key->designation_id])->row()->designation_name ?></option>
                                                        <?php endforeach; ?>
                                                    </select>
                                                </div>
                                            </div>

                                            <div id="cad_slot_date_div">
                                                <?php if(!empty($project_cad_member)): ?>
                                                <?php foreach ($project_cad_member as $key): ?>
                                                <div class="form-group" id="cad_slot_date_single_div<?php echo $key ?>">
                                                    <!-- <div class="col-md-2"><span class="badge badge-primary"><?php //echo $key->name.' - '.$key->designation_name ?></span></div>
                                                    <div class="col-md-4">
                                                        <input type="text" value="<?php //echo date('m/d/Y', strtotime($key->date)) ?>" class="form-control slot-datepicker" data-user="<?php //echo $key ?>" name="cad_slot_date[<?php //echo $key ?>]" placeholder="Select cad date" autocomplete="off">
                                                    </div>
                                                    <div class="col-md-1">
                                                        <a class="btn btn-sm btn-circle btn-default cad_slots_modal_btn" target="_blank" href="<?php echo base_url('cad_slots/'.$key) ?>">Cad Slot</a>
                                                    </div> -->


                                                    <!-- Cad slot -->
                                                    <?php $cad_date = $this->db->get_where('cad_slots', ['user_id' => $key, 'project_id' => $project->project_id])->row(); ?>
                                                    <div class="col-md-2"><span class="badge badge-primary"><?php echo $this->db->get_where('user', ['id' => $key])->row()->name ?></span></div>
                                                    <?php if(!empty($cad_date)): ?>
                                                    <div class="col-md-4">
                                                        <input type="text" value="<?php echo date('m/d/Y', strtotime($cad_date->date)) ?>" class="form-control slot-datepicker" data-user="<?php echo $key ?>" name="cad_slot_date[<?php echo $key ?>]" placeholder="Select cad date" autocomplete="off">
                                                    </div>
                                                    <?php else: ?>
                                                    <div class="col-md-4">
                                                        <input type="text" value="" class="form-control slot-datepicker" data-user="<?php echo $key ?>" name="cad_slot_date[<?php echo $key ?>]" placeholder="Select cad date" autocomplete="off">
                                                    </div>
                                                    <?php endif; ?>
                                                    <div class="col-md-1">
                                                        <a class="btn btn-sm btn-circle btn-default cad_slots_modal_btn" target="_blank" href="<?php echo base_url('cad_slots/'.$key) ?>">Cad Slot</a>
                                                    </div> 



                                                    <!-- check that 3d print exist or not -->
                                                    <?php $cad_3d_print_date = $this->db->get_where('cad_3d_print_date', ['user_id' => $key, 'project_id' => $project->project_id])->row(); ?>
                                                    <?php if(!empty($cad_3d_print_date)): ?>
                                                    <div class="col-md-4">
                                                        <input type="text" value="<?php echo date('m/d/Y', strtotime($cad_3d_print_date->date)) ?>" class="form-control 3d-print-datepicker" data-user="<?php echo $key ?>" name="cad_3d_print_date[<?php echo $key ?>]" placeholder="Select 3d print date" autocomplete="off">
                                                    </div>
                                                    <?php else: ?>
                                                    <div class="col-md-4">
                                                        <input type="text" class="form-control 3d-print-datepicker" data-user="<?php echo $key ?>" name="cad_3d_print_date[<?php echo $key ?>]" placeholder="Select 3d print date" autocomplete="off">
                                                    </div>
                                                    <?php endif; ?>
                                                </div>
                                                <?php endforeach;?>
                                                <?php endif; ?>
                                            </div>
                                            <?php endif; ?>
                                            <?php endif; ?>


                                            <?php if(!in_array($designation_id, [9])): ?>
                                            <?php if ($client_approval) : ?>
                                            <!-- disposition -->
                                            <hr style="border-top: 1px solid #bdbdbd;">
                                            <div class="form-group">
                                                <label class="col-md-12" for="disposition">Disposition</label><br>
                                                <div class="col-md-10">
                                                    <select name="project[disposition]" id="disposition" class="form-control">
                                                        <option value="0">No Disposition Assigned</option>
                                                        <?php foreach ($disposition as $key) : ?>
                                                        <option value="<?= $key->disposition_id ?>" <?= $project_details->disposition == $key->disposition_id ? 'selected' : ''?>><?= $key->name ?></option>
                                                        <?php endforeach; ?>
                                                    </select>
                                                </div>
                                                <?php if ($client_approval) : ?>
                                                <div class="col-md-2">
                                                    <button class="btn btn-default" type="button" id="Add">Add Disposition</button>
                                                </div>
                                                <?php endif; ?>
                                            </div>
                                            <?php endif; ?>
                                            <?php endif; ?>


                                            <?php if(!in_array($designation_id, [9])): ?>
                                            <?php if ($client_approval) : ?>
                                            <!-- disposition internal -->
                                            <div class="form-group">
                                                <label class="col-md-12" for="disposition">Internal Disposition</label><br>
                                                <div class="col-md-10">
                                                    <select name="project[disposition]" id="disposition_internal" class="form-control">
                                                        <option value="0">No Disposition Assigned</option>
                                                        <?php foreach ($disposition as $key) : ?>
                                                        <option value="<?= $key->disposition_id ?>" <?= $project_details->disposition == $key->disposition_id ? 'selected' : ''?>><?= $key->name ?></option>
                                                        <?php endforeach; ?>
                                                    </select>
                                                </div>
                                                <?php if ($client_approval) : ?>
                                                <div class="col-md-2">
                                                    <button class="btn btn-default" type="button" id="add_disposition_internal">Add Disposition</button>
                                                </div>
                                                <?php endif; ?>
                                            </div>
                                            <hr style="border-top: 1px solid #bdbdbd;">
                                            <?php endif; ?>
                                            <?php endif; ?>

                                            <!-- Priority -->
                                            <?php if(!in_array($designation_id, [9])): ?>
                                            <div class="form-group">
                                                <div class="col-md-12">
                                                    <label for="">Project Priority</label>
                                                    <select name="project[priority]" class="form-control" <?php echo !$client_approval ? 'disabled' : '' ?>>
                                                        <option value="standard"
                                                        <?= $project_details->priority == 'standard' ? 'selected' : '' ?>>Standard Priority</option>
                                                        <option value="high"
                                                        <?= $project_details->priority == 'high' ? 'selected' : '' ?>>High Priority</option>
                                                        <option value="critical"
                                                        <?= $project_details->priority == 'critical' ? 'selected' : '' ?>>Critical</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <?php endif; ?>

                                            <?php if(!in_array($designation_id, [9])): ?>
                                            <div class="form-group">
                                                <div class="col-md-12">
                                                    <label for="">Project Deadline</label>
                                                    <input name="project[deadline]" class="form-control" type="text"  value="<?php echo !in_array($project_details->deadline, [NULL, '1970-01-01', '0000-00-00']) ? date('m/d/Y', strtotime($project_details->deadline)) : '' ?>" id="calendar" <?php echo !$client_approval ? 'disabled' : '' ?> placeholder="No deadline assigned">
                                                </div>
                                            </div>
                                            <?php endif; ?>

                                             <!-- Internal Deadline -->
                                            <?php if($client_approval): ?>
                                            <div class="form-group">
                                                <div class="col-md-12">
                                                    <label for="">Project Internal Deadline</label>
                                                    <input name="project[internal_deadline]" class="form-control" type="text"  value="<?php echo !in_array($project_details->internal_deadline, [NULL, '1970-01-01', '0000-00-00']) ? date('m/d/Y', strtotime($project_details->internal_deadline)) : '' ?>" id="internal_deadline_calendar" placeholder="No internal deadline assigned">
                                                </div>
                                            </div>
                                            <?php endif; ?>

                                            <!-- Price -->
                                            <?php if($member_permission): ?>
                                            <div class="form-group">
                                                <div class="col-md-4">
                                                    <label for="">Budget <span class="font-green-meadow"><?php echo $project_details->request_estimate == 1 ? '(Estimate requested)' : '' ?></span></label>
                                                    <input value="<?= $project_details->price ?>" name="project[price]" type="number" class="form-control" placeholder="Bugdet..."  <?php echo !$client_approval ? 'disabled' : '' ?>>
                                                </div>

                                                <!-- Estimated price -->
                                                <?php switch ($project_details->estimated_approve) {
                                                    case 1:
                                                        $estimated_approve = 'Aprroved';
                                                        $estimated_approve_class = 'success';
                                                        break;
                                                    case 2:
                                                        $estimated_approve = 'Revise';
                                                        $estimated_approve_class = 'warning';
                                                        break;
                                                    case 3:
                                                        $estimated_approve = 'Declined';
                                                        $estimated_approve_class = 'danger';
                                                        break;
                                                    case 0:
                                                        $estimated_approve = 'No action yet';
                                                        $estimated_approve_class = 'secondary';
                                                        break;
                                                } ?>
                                                <?php if($client_approval): ?>
                                                <div class="col-md-4">
                                                    <label for="">Estimate Price 
                                                        <span class="badge badge-<?php echo $estimated_approve_class ?>"><?php echo $estimated_approve ?></span> 
                                                        <span type="button" class="badge badge-primary send_quote" style="cursor: pointer;">Send quote</span> 
                                                        <!-- <button class="btn btn-sm btn-circle" type="button">Send Quote</button> -->
                                                    </label>
                                                    <input type="text" class="form-control" name="project[estimated_price]" value="<?= $project_details->estimated_price == 0 ? '' : $project_details->estimated_price ?>" placeholder="Estimated Price">
                                                </div>
                                                <?php endif; ?>
                                                
                                                <?php if(!$client_approval): ?>
                                                <div class="col-md-4">
                                                    <label for="">Recieved Price 
                                                        <span class="badge badge-<?php echo $estimated_approve_class ?>"><?php echo $estimated_approve ?></span> 
                                                    </label>
                                                    <input type="text" class="form-control" name="project[estimated_price]" value="<?= $project_details->estimated_price == 0 ? '' : $project_details->estimated_price ?>" placeholder="Recieved Price" disabled>
                                                </div> 
                                                <?php endif; ?>

                                                <?php if ($client_approval) : ?>
                                                <div class="col-md-4">
                                                    <label for="">Project Price Type</label>
                                                    <select name="project[price_type]" class="form-control" <?php echo !$client_approval ? 'disabled' : '' ?>>
                                                        <option value="">Select price Type</option>
                                                        <option value="plus_tax" <?= $project_details->price_type == 'plus_tax' ? 'selected' : ''?>>Plus Tax</option>
                                                        <option value="include_tax" <?= $project_details->price_type == 'include_tax' ? 'selected' : ''?>>Include Tax</option>
                                                        <option value="tax_exempt" <?= $project_details->price_type == 'tax_exempt' ? 'selected' : ''?>>Tax Exempt</option>
                                                    </select>
                                                </div>
                                                <?php else: ?>
                                                <div class="col-md-4">
                                                    <label for="">Estimateed price status</label>
                                                    <select name="project[estimated_approve]" class="form-control" <?= $project_details->estimated_price == 0 ? 'disabled' : '' ?>>
                                                        <option value="" selected="" disabled="">Change estimateed price status</option>
                                                        <option value="1">Approve</option>
                                                        <option value="2">Revise</option>
                                                        <option value="3">Decline</option>
                                                    </select>
                                                </div>
                                                <?php endif; ?>
                                            </div>
                                            <?php endif; ?>


                                            <!-- PO# -->
                                            <div class="form-group">
                                                <div class="col-md-12">
                                                    <label for="">Project Po</label>
                                                    <input value="<?= $project_details->po ?>" name="project[po]" type="text" class="form-control" placeholder="PO#"  <?php echo !$client_approval ? 'disabled' : '' ?>>
                                                </div>
                                            </div>

                                            <!-- Tracking# -->
                                            <div class="form-group">
                                                <div class="col-md-12">
                                                    <label for="">Project Tracking</label>
                                                    <input value="<?php $project_details->tracking ?>" name="project[tracking]" type="text" class="form-control" placeholder="Tracking#"  <?php echo !$client_approval ? 'disabled' : '' ?>>
                                                </div>
                                            </div>
                                            
                                            <!-- Job title -->
                                            <div class="form-group">
                                                <div class="col-md-12">
                                                    <label for="">Project Title</label>
                                                    <input id="job_title" name="project[title]" type="text" value="<?= $project_details->title ?>" class="form-control" placeholder="Job title" maxlength="30" <?php echo !$client_approval ? 'disabled' : '' ?>>
                                                </div>
                                                <div class="col-md-12 text-right">
                                                    <span><span id="job_title_cn"></span>/30</span>
                                                    <a id="sample_editable_1_new" data-toggle="modal" data-target="#revision_history"><i class="fas fa-info-circle"></i></a>
                                                </div>
                                            </div>

                                            
                                            <!-- Job desc -->
                                            <div class="form-group">
                                                <div class="col-md-6">
                                                    <label for="">Project Description</label>
                                                    <textarea style="resize: vertical;" name="project[description]" class="form-control" rows="8" placeholder="Job Description..."><?= $project_details->description ?></textarea>
                                                   <!--  <?php if(!$client_approval && $project_details->desc_approval == 0): ?>
                                                    <span style="margin-top: 20px" class="label label-sm label-success">Waiting for approval</span>
                                                    <?php endif; ?> -->
                                                </div>
                                                <div class="col-md-6">
                                                    <h4 style="margin-top: 0">Description History</h4>
                                                    <div id="project_description_history">
                                                        <table class="table">
                                                            <tbody>
                                                                <?php foreach ($project_description_history as $key): ?>
                                                                <tr>
                                                                    <td><a href="<?php echo base_url('Project_controller/project_description/'.$key->project_description_history_id)?>"><?php echo word_limiter($key->description, 10) ?></a></td>
                                                                    <td>
                                                                    <?php echo time_elapsed_string(date_convert(date('d-m-Y H:i:s', strtotime($key->created_at)), 'Y-m-d H:i:s')) ?>
                                                                    </td>
                                                                    <?php if($client_approval && !in_array($designation_id, [9])): ?>
                                                                    <?php if($key->approve == 0): ?>
                                                                    <td><button class="btn btn-default btn-sm desc_approval_btn" value="<?php echo $key->project_description_history_id?>" type="button">Approve</button></td>
                                                                    <?php else: ?>
                                                                    <td>Approved</td>
                                                                    <?php endif; ?>
                                                                    <?php else: ?>
                                                                    <td><?php echo $key->approve == 0 ? 'Waiting for approval' : 'Approved'  ?></td>
                                                                    <?php endif; ?>
                                                                </tr>
                                                                <?php endforeach; ?>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <?php if($member_permission): ?>
                                            <div class="form-group">
                                                <div class="col-md-12">
                                                    <button type="submit" class="btn btn-circle btn-md green">Save</button>
                                                </div>
                                            </div>
                                            <?php endif; ?>

                                        </div>
                                    </form>

                                    <!-- specification -->
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <button class="btn" type="button" data-toggle="collapse" data-target="#multiCollapseExample1" aria-expanded="false" aria-controls="multiCollapseExample2">Specification</button>
                                            <button style="float: right;" class="btn" type="button" data-toggle="collapse" data-target="#multiCollapseExample2" aria-expanded="false" aria-controls="multiCollapseExample2">Add Specification</button>
                                        </div>
                                        
                                        <div class="collapse multi-collapse" id="multiCollapseExample2">
                                            <form id="" action="<?php echo base_url('Project_controller/update_project_specification_action/'.$project->project_id)?>" class="form-horizontal" method="POST" onkeydown="return event.key != 'Enter';">
                                                <div class="form msg-frm" style="padding: 20px !important">
                                                    <div class="form-group">
                                                        <!-- Finish -->
                                                        <div class="col-md-2">
                                                            <span>Finish</span>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select name="project_specification[finish]" class="form-control">
                                                                <option value="">Choose Value</option>
                                                                <?php foreach ($specification_finish as $key => $value) : ?>
                                                                <option value="<?= $value ?>"
                                                                    <?= $project_specification->finish == $value ? 'selected' : ''?>><?= $value ?></option>
                                                                <?php endforeach ?>
                                                            </select>
                                                        </div>
                                                        <!-- Purity / Color / Metal -->
                                                        <div class="col-md-2">
                                                            <span>Purity / Color / Metal</span>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select name="project_specification[purity]" class="form-control">
                                                                <option value="">Choose Value</option>
                                                                <?php foreach ($specification_purity as $key => $value) : ?>
                                                                <option value="<?= $value ?>" <?= $project_specification->purity == $value ? 'selected' : ''?>><?= $value ?></option>
                                                                <?php endforeach; ?>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <!-- Ring Size -->
                                                        <div class="col-md-2">
                                                            <span>Ring Size</span>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select name="project_specification[ring_size]" class="form-control">
                                                                <option value="">Choose Value</option>
                                                                <?php foreach ($specification_ring_size as $key => $value) : ?>
                                                                <option value="<?= $value ?>" <?= $project_specification->ring_size == $value ? 'selected' : ''?>><?= $value ?></option>
                                                                <?php endforeach; ?>
                                                            </select>
                                                        </div>
                                                        <!-- Plating -->
                                                        <div class="col-md-2">
                                                            <span>Plating</span>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select name="project_specification[plating]" class="form-control">
                                                                <option value="">Choose Value</option>
                                                                <?php foreach ($specification_plating as $key => $value) : ?>
                                                                <option value="<?= $value ?>" <?= $project_specification->plating == $value ? 'selected' : ''?>><?= $value ?></option>
                                                                <?php endforeach; ?>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <div class="col-md-12">
                                                            <input value="<?= $project_specification->custom ?>" name="project_specification[custom]" type="text" placeholder="Custom Specification" class="form-control">
                                                        </div>
                                                    </div>


                                                    <hr>


                                                    <div class="form-group">
                                                        <!-- Wax only -->
                                                        <div class="col-md-2">
                                                            <span>Wax Only</span>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select name="project_specification[wax_only]" class="form-control" id="wax_only">
                                                                <option value="">Choose Value</option>
                                                                <?php foreach ($specification_wax_only as $key => $value) : ?>
                                                                <option value="<?= $value ?>" <?= $project_specification->wax_only == $value ? 'selected' : ''?>><?= $value ?></option>
                                                                <?php endforeach ?>
                                                            </select>
                                                        </div>
                                                        <!-- Wax Only Resin -->
                                                       <!--  <div id="wax_only_resin">
                                                        <div class="col-md-2">
                                                            <span>Wax Only Resin</span>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select name="project_specification[wax_only_resin]" class="form-control">
                                                                <option value="">Choose Value</option>
                                                                <?php foreach ($specification_wax_only_resin as $key => $value) : ?>
                                                                <option value="<?= $value ?>" <?= $project_specification->wax_only_resin == $value ? 'selected' : ''?>><?= $value ?></option>
                                                                <?php endforeach ?>
                                                            </select>
                                                        </div>
                                                        </div> -->
                                                    </div>

                                                    <div class="form-group">
                                                        <!-- Casting Only -->
                                                        <div class="col-md-2">
                                                            <span>Casting Only</span>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select name="project_specification[casting_only]" class="form-control">
                                                                <option value="">Choose Value</option>
                                                                <?php foreach ($specification_casting_only as $key => $value) : ?>
                                                                <option value="<?= $value ?>" <?= $project_specification->casting_only == $value ? 'selected' : ''?>><?= $value ?></option>
                                                                <?php endforeach ?>
                                                            </select>
                                                        </div>
                                                        <!-- Mold -->
                                                        <div class="col-md-2">
                                                            <span>Mold</span>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select name="project_specification[mold]" class="form-control">
                                                                <option value="">Choose Value</option>
                                                                <?php foreach ($specification_mold as $key => $value) : ?>
                                                                <option value="<?= $value ?>"  <?= $project_specification->mold == $value ? 'selected' : ''?>><?= $value ?></option>
                                                                <?php endforeach ?>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <!-- Supply Diamonds -->
                                                        <div class="col-md-2">
                                                            <span>Supply Diamonds</span>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select name="project_specification[supply_diamonds]" class="form-control">
                                                                <option value="">Choose Value</option>
                                                                <?php foreach ($specification_supply_diamonds as $key => $value) : ?>
                                                                <option value="<?= $value ?>" <?= $project_specification->supply_diamonds == $value ? 'selected' : ''?>><?= $value ?></option>
                                                                <?php endforeach ?>
                                                            </select>
                                                        </div>
                                                        <!-- Supply Center -->
                                                        <div class="col-md-2">
                                                            <span>Supply Center</span>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select name="project_specification[supply_center]" class="form-control">
                                                                <option value="">Choose Value</option>
                                                                <?php foreach ($specification_supply_center as $key => $value) : ?>
                                                                <option value="<?= $value ?>" <?= $project_specification->supply_center == $value ? 'selected' : ''?>><?= $value ?></option>
                                                                <?php endforeach ?>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <!-- Supply All Gems -->
                                                        <div class="col-md-2">
                                                            <span>Supply All Gems</span>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select name="project_specification[supply_all_gems]" class="form-control" id="supply_all_gems">
                                                                <option value="">Choose Value</option>
                                                                <?php foreach ($specification_supply_all_gems as $key => $value) : ?>
                                                                <option value="<?= $value ?>" <?= $project_specification->supply_all_gems == $value ? 'selected' : ''?>><?= $value ?></option>
                                                                <?php endforeach ?>
                                                            </select>
                                                        </div>
                                                        <!-- Supply Center -->
                                                        <div id="supply_all_gems_yes">
                                                        <div class="col-md-2">
                                                            <span>Supply All Gems</span>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select name="project_specification[supply_all_gems_yes]" class="form-control">
                                                                <option value="">Choose Value</option>
                                                                <?php foreach ($specification_supply_all_gems_yes as $key => $value) : ?>
                                                                <option value="<?= $value ?>" <?= $project_specification->supply_all_gems_yes == $value ? 'selected' : ''?>><?= $value ?></option>
                                                                <?php endforeach ?>
                                                            </select>
                                                        </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <!-- Supply All Gems -->
                                                        <div class="col-md-2">
                                                            <span>Sending my own</span>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select name="project_specification[sending_my_own]" class="form-control">
                                                                <option value="">Choose Value</option>
                                                                <?php foreach ($specification_sending_my_own as $key => $value) : ?>
                                                                <option value="<?= $value ?>"  <?= $project_specification->sending_my_own == $value ? 'selected' : ''?>><?= $value ?></option>
                                                                <?php endforeach ?>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    
                                                    

                                                    <?php if(!in_array($designation_id, [9])): ?>
                                                    <?php if($member_permission): ?>
                                                    <div class="form-actions right todo-form-actions">
                                                        <button type="submit" class="btn btn-circle btn-sm green">Save Specification</button>
                                                    </div>
                                                    <?php endif; ?>
                                                    <?php endif; ?>
                                                    
                                                </div>
                                            </form>
                                        </div>
                                        
                                        <div class="collapse multi-collapse in show" id="multiCollapseExample1">
                                            <div class="row" style="margin: 20px">
                                                <ul class="nav nav-tabs" id="myTab" role="tablist">
                                                  <li class="nav-item active">
                                                    <a class="nav-link active show" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Specification</a>
                                                  </li>
                                                  <li class="nav-item">
                                                    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Specification History</a>
                                                  </li>
                                                </ul>
                                                <div class="tab-content" id="myTabContent">
                                                    <div class="tab-pane fade show active in" id="home" role="tabpanel" aria-labelledby="home-tab">
                                                        <div class="col-md-6">
                                                            <ul>
                                                                <li>Ring Size : <span class="text-info"><?php echo $project_specification->ring_size ?></span></li>
                                                                <li>Purity / Color / Metal:  <span class="text-info"><?php echo $project_specification->purity ?></span></li>
                                                                <li>Plating:  <span class="text-info"><?php echo $project_specification->plating ?></span></li>
                                                                <li>Finish:  <span class="text-info"><?php echo $project_specification->finish ?></span></li>
                                                                <li>Custom:  <span class="text-info"><?php echo $project_specification->custom ?></span></li>
                                                            </ul>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <ul>
                                                                <li>
                                                                    Wax Only : <span class="text-info"><?php echo $project_specification->wax_only ?></span> / 
                                                                    Casting Only:  <span class="text-info"><?php echo $project_specification->casting_only ?></span>
                                                                </li>
                                                                <li>Mold:  <span class="text-info"><?php echo $project_specification->mold ?></span></li>
                                                                <li>Supply Diamonds:  <span class="text-info"><?php echo $project_specification->supply_diamonds ?></span></li>
                                                                <li>Supply Center:  <span class="text-info"><?php echo $project_specification->supply_center ?></span></li>
                                                                <li>
                                                                    Supply All Gems:  <span class="text-info"><?php echo $project_specification->supply_all_gems ?> <?php echo $project_specification->supply_all_gems == 'Yes' ? 
                                                                    '/' : '' ?> <?php echo $project_specification->supply_all_gems_yes ?></span>
                                                                </li>
                                                                <li>Sending my own: <span class="text-info"> <?php echo $project_specification->sending_my_own ?></span></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                                        <table class="table">
                                                            <tbody>
                                                                <?php foreach ($project_specification_history as $key): ?>
                                                                <tr>
                                                                    <td><?php echo ucwords($key->type).' changed to '.$key->value ?></td>

                                                                    <?php if($client_approval && !in_array($designation_id, [9])): ?>
                                                                    <?php if($key->approve == 0): ?>
                                                                    <td><button class="btn btn-default btn-sm spec_approval_btn" value="<?php echo $key->project_specification_history_id?>" type="button">Approve</button></td>
                                                                    <?php else: ?>
                                                                    <td>Approved</td>
                                                                    <?php endif; ?>
                                                                    <?php else: ?>
                                                                    <td><?php echo $key->approve == 0 ? 'Waiting for approval' : 'Approved'  ?></td>
                                                                    <?php endif; ?>
                                                                    <td>
                                                                        <?php echo time_elapsed_string(date_convert(date('d-m-Y H:i:s', strtotime($key->created_at)), 'Y-m-d H:i:s')) ?>
                                                                    </td>
                                                                </tr>
                                                                <?php endforeach; ?>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <!-- end specification -->

                                    <!-- message -->
                                    <div class="panel panel-default" id="message_panel">
                                        <div class="panel-heading">
                                            <button id="messaging_id" class="btn" type="button" data-toggle="collapse" data-target="#messaging" aria-expanded="true" aria-controls="multiCollapseExample2">Messaging</button>
                                            <button id="reply_btn"  style="float: right;" class="btn" type="button" data-toggle="collapse" data-target="#create_msg" aria-expanded="false" aria-controls="create_msg">Create Message</button>
                                        </div>
                                        <div class="collapse multi-collapse" id="create_msg">
                                            <div class="form msg-frm" style="padding: 20px !important">
                                                <form class="form-horizontal" id="message_send" action="">
                                                    <div class="form-group">
                                                        <div class="col-md-8">
                                                            <textarea style="resize: vertical;" name="msg" id="" cols="30" rows="5" placeholder="Message" class="form-control" required=""></textarea>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select class="form-control" name="msg_to" id="msg_user" required="">
                                                                <?php $project_assignee = explode(',', $project_details->assignee); ?>
                                                                <option value="" selected="" disable>Select User</option>
                                                                <?php $i = 1; foreach ($msg_user as $key): ?>
                                                                <?php if(in_array($designation_id,[5,7])): ?>
                                                                    <?php if(in_array($key->id, $project_assignee)): ?>
                                                                    <option value="<?php echo $key->id ?>">
                                                                        <?php if($key->designation_id == 9): ?>
                                                                        <?php echo 'Cad Team '.$i; $i++; ?>
                                                                        <?php else: ?>
                                                                        <?php echo $key->name.' - '.$key->designation_id ?>
                                                                        <?php endif ?>
                                                                    </option>
                                                                    <?php endif; ?>
                                                                <?php else: ?>
                                                                    <?php if(in_array($key->id, $project_assignee)): ?>
                                                                    <option value="<?php echo $key->id ?>"><?php echo $key->name.' - '.$key->designation_name ?></option>
                                                                    <?php endif; ?>
                                                                    <?php if($key->id == $project->asign_user): ?>
                                                                    <option value="<?php echo $key->id ?>"><?php echo $key->name.' - '.$key->designation_name ?></option>
                                                                    <?php endif; ?>
                                                                <?php endif; ?>
                                                                <?php endforeach; ?>
                                                                <?php $associated_member = $this->projectmodel->get_associated_member($project->asign_user); ?>
                                                                <?php foreach ($associated_member as $key): ?>
                                                                <option value="<?php echo $key->id ?>"><?php echo $key->name.' - '.$key->designation_name ?> (Assoc)</option>
                                                                <?php endforeach; ?>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <input type="hidden" name="project_id" value="<?= $project->project_id ?>">
                                                    <div class="form-actions right todo-form-actions">
                                                        <button type="submit" class="btn btn-circle btn-sm green">
                                                        Send
                                                        </button>
                                                    </div>
                                                </form>
                                                <form class="form-horizontal" id="reply_send" action="">
                                                    <div class="form-group">
                                                        <div class="col-md-12">
                                                            <textarea style="resize: vertical;" name="msg" id="" cols="30" rows="5" placeholder="Message" class="form-control" required=""></textarea>
                                                            <!-- <input name="msg" type="text" placeholder="Message" class="form-control"> -->
                                                        </div>
                                                    </div>
                                                    <input type="hidden" name="project_id" value="<?= $project->project_id ?>">
                                                    <input type="hidden" id="project_msg_id" name="project_msg_id">
                                                    <div class="form-actions right todo-form-actions">
                                                        <button type="submit" class="btn btn-circle btn-sm green">
                                                        Send
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        
                                        <div class="table-responsive collapse multi-collapse in show" id="messaging">
                                            <table class="table table-condensed table-sm" style="margin: 20px">
                                                <thead>
                                                    <tr>
                                                        <td>Msg By</td>
                                                        <td>Msg To</td>
                                                        <td>Msg</td>
                                                        <td>Reply</td>
                                                        <td>Messaged At</td>
                                                        <td>Action</td>
                                                    </tr>
                                                </thead>
                                                <tbody id="msg_tbody">
                                                    <?php foreach ($project_msg as $key) : ?>
                                                    <tr>
                                                        <td><?php
                                                         if($key->msg_by == ''){
                                                            echo "";
                                                         } else{
                                                            $msg_by_des = $this->db->get_where('user', ['id' => $key->msg_by])->row()->designation_id;
                                                            if(in_array($designation_id, [5,7])){
                                                                if($msg_by_des == 9)
                                                                    echo $this->db->get_where('designation', ['designation_id' => $msg_by_des])->row()->designation_name;
                                                                else
                                                                    echo $this->db->get_where('user', ['id' => $key->msg_by])->row()->name.' - '. $this->db->get_where('designation', ['designation_id' => $msg_by_des])->row()->designation_name;
                                                                    // echo $this->db->get_where('designation', ['designation_id' => $msg_by_des])->row()->designation_name;

                                                            } else{
                                                                echo $this->db->get_where('user', ['id' => $key->msg_by])->row()->name.' - '. $this->db->get_where('designation', ['designation_id' => $msg_by_des])->row()->designation_name;
                                                            }
                                                         } ?></td>
                                                        <td>
                                                            <?php 
                                                            if($key->msg_to == ''){
                                                                echo "";
                                                            } else{
                                                                $msg_to_des = $this->db->get_where('user', ['id' => $key->msg_to])->row()->designation_id;
                                                                if(in_array($designation_id, [5,7])){
                                                                    if($msg_to_des == 9)
                                                                        echo $this->db->get_where('designation', ['designation_id' => $msg_to_des])->row()->designation_name;
                                                                    else
                                                                        echo $this->db->get_where('user', ['id' => $key->msg_to])->row()->name.' - '. $this->db->get_where('designation', ['designation_id' => $msg_to_des])->row()->designation_name;
                                                                        // echo $this->db->get_where('designation', ['designation_id' => $msg_to_des])->row()->designation_name;

                                                                } else{
                                                                    echo $this->db->get_where('user', ['id' => $key->msg_to])->row()->name.' - '. $this->db->get_where('designation', ['designation_id' => $msg_to_des])->row()->designation_name;
                                                                }
                                                            } 

                                                             ?>
                                                        </td>
                                                        <td><?= wordwrap($key->msg,30,"<br>\n"); ?></td>
                                                        <td><?= wordwrap($key->reply,30,"<br>\n"); ?></td>
                                                        <td><?= date_convert(date('d-m-Y H:i:s', strtotime($key->created_at)), 'd/m/y h:i A'); ?></td>
                                                        <td>
                                                            <?php if($key->msg_to != 0): ?>
                                                                <?php if($key->msg_to == $this->session->userdata('user_id') || $this->session->userdata('user_id') == 1): ?>
                                                                <?php if($key->reply == ''): ?>
                                                                <button class="btn reply btn-xs" value="<?php echo $key->project_msg_id ?>" href="<?php echo base_url('Project_controller/msg_history/'.$key->project_id.'/'.$key->msg_to)?>"><i class="fa fa-reply" aria-hidden="true"></i>Reply</button>
                                                                <?php endif; ?>
                                                                <?php endif; ?>
                                                            <?php endif; ?>
                                                        </td>
                                                    </tr>
                                                    <?php endforeach; ?>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <!-- end message -->


                                     <!-- Note -->
                                    <?php if(in_array($designation_id, [1, 6, 8])): ?>
                                    <div class="panel panel-default" id="message_panel">
                                        <div class="panel-heading">
                                            <button class="btn collapsed" type="button" data-toggle="collapse" data-target="#notes" aria-expanded="false" aria-controls="notes">Notes</button>
                                            <button style="float: right;" class="btn collapsed" type="button" data-toggle="collapse" data-target="#create_note" aria-expanded="false" aria-controls="create_note">Create Notes</button>
                                        </div>
                                        <div class="collapse multi-collapse" id="create_note">
                                            <div class="form msg-frm" style="padding: 20px !important" aria-expanded="false">
                                                <form id="create_note_form" method="POST">
                                                    <input type="hidden" name="note[project_id]" value="<?php echo $project->project_id; ?>">
                                                    <div class="form-group">
                                                        <input type="text" class="form-control" name="note[note]" placeholder="Create Note">
                                                    </div>
                                                    <div class="form-group">
                                                        <button class="btn btn-circle green">Save Note</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        
                                        <div class="collapse multi-collapse" id="notes" aria-expanded="false">
                                            <div class="form msg-frm" style="padding: 20px !important">
                                                <table class="table" id="notes_table">
                                                    <?php if(!empty($project_notes)): ?>
                                                    <?php foreach ($project_notes as $key) : ?>
                                                    <tr>
                                                        <td>
                                                            <?php echo $this->db->get_where('user', ['id' => $key->user_id])->row()->name ?>: <?php echo date('m/d/Y',strtotime($key->created_at)) ?> <?php echo $key->note ?>
                                                            <button class="btn btn-sm btn-circle btn-danger pull-right delete_note" value="<?php echo $key->project_note_id ?>">delete</button>    
                                                        </td>
                                                    </tr>
                                                    <?php endforeach; ?>
                                                    <?php else: ?>
                                                    <tr><td>No Notes</td></tr>
                                                    <?php endif; ?>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <?php endif; ?>
                                    <!-- end Note -->

                                    <!-- Upload Image -->
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <button class="btn" type="button" data-toggle="collapse" data-target="#upload_file_input_div" aria-expanded="false" aria-controls="uploaded_file">Project Files</button>
                                            <button style="float: right;" class="btn" type="button" data-toggle="collapse" data-target="#uploaded_file" aria-expanded="false" aria-controls="uploaded_file">Upload File</button>
                                        </div>

                                        <div class="collapse multi-collapse" id="uploaded_file">
                                            <div class="row" style="margin: 20px">
                                                <div class="col-md-12">
                                                    <div class="form-group" style="margin-top: 20px">
                                                        <label for="">Cad</label>
                                                        <div class="file-loading" id="krajee_file">
                                                            <input id="file-1" type="file" multiple class="file" name="file[]">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-12">
                                                    <div class="form-group" style="margin-top: 20px">
                                                        <label for="">Pic</label>
                                                        <div class="file-loading" id="krajee_file">
                                                            <input id="file-2" type="file" multiple class="file" name="file[]">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="collapse multi-collapse in show" id="upload_file_input_div">
                                            <div class="row" style="margin: 20px">
                                                <div class="col-md-12">
                                                    <form enctype="multipart/form-data" method="POST" action="<?php echo base_url('Project_controller/file_action/'.$this->uri->segment(3))?>">
                                                        <div class="row">
                                                            <?php if($client_approval): ?>
                                                            <div class="col-md-4">
                                                                <select class="form-control" name="action" id="file_action" required="">
                                                                    <option value="" disabled selected>Select Action</option>
                                                                    <?php if(in_array($designation_id, [1,6,8])): ?>
                                                                    <option value="thumbnail">Mark as Thumbnail</option>
                                                                    <option value="client_visible">Visible to client</option>
                                                                    <option value="client_invisible">Invisible to client</option>
                                                                    <?php endif; ?>
                                                                    <?php if(in_array($designation_id, [1,6,8])): ?>
                                                                    <option value="visible_cad">Visible To Cad</option>
                                                                    <option value="invisible_cad">Invisible To Cad</option>
                                                                    <?php endif; ?>
                                                                    <?php if(in_array($designation_id, [1,6,8,9])): ?>
                                                                    <option value="archive">Archive Files</option>
                                                                    <?php endif; ?>
                                                                    <?php if(in_array($designation_id, [1,6,8])): ?>
                                                                    <option value="delete">Delete files</option>
                                                                    <?php endif; ?>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <select placeholder="Select Group" class="form-control" name="group[]" id="archive_groups" multiple="" disabled>
                                                                <?php foreach ($project_archive_group as $key): ?>
                                                                <option value="<?php echo $key->project_archive_group_id ?>"><?php echo $key->group_name ?></option>
                                                                <?php endforeach; ?>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-2 text-center">
                                                                <button type="button" class="btn btn-circle btn-md" id="add_archive_group">Add Group</button>
                                                            </div>
                                                            <div class="col-md-2 text-center">
                                                                <button class="btn btn-circle btn-md green">Save Action</button>
                                                            </div>
                                                            <?php endif; ?>
                                                        </div>

                                                        <!-- cad file -->
                                                        <?php $file_types = ['cad', 'pic']; ?>
                                                        <?php foreach ($file_types as $file_type) : ?>

                                                        <h4><?php echo ucwords($file_type); ?> Files</h4>
                                                        <ul class="list-group" id="archive_files">                                                        
                                                            <?php foreach ($project_files as $key) : ?>
                                                            <?php $file = pathinfo($key->file_name); ?>
                                                            <?php $proj_files_user = $this->db->get_where('user', ['id' => $key->user_id])->row(); ?>
                                                            <?php $proj_files_user_des = $this->db->get_where('designation', ['designation_id' => $proj_files_user->designation_id])->row(); ?>
                                                            <?php if($key->type == $file_type): ?>
                                                            <?php $assign_by = $this->db->get_where('project', ['project_id' => $key->project_id])->row()->assign_by; ?>
                                                                <?php if(in_array($designation_id,[5,7])): // only for clients ?>
                                                                    <?php if($key->user_id == $assign_by): ?>
                                                                    <li class="list-group-item" title="<?php echo $key->file_name ?>">
                                                                        <div>
                                                                            <?php if(isset($file['extension']) && in_array($file['extension'], ['jpg', 'png', 'jpeg', 'JPG', 'PNG', 'JPEG'])): ?>
                                                                            <img class='proj_img' src='<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name?>' alt='' width="75">
                                                                            <?php else: ?>
                                                                            <img class='proj_img' src='<?= base_url('/assets/images/default_file_icon.png') ?>' alt='' width="50">
                                                                            <?php endif; ?>
                                                                            <span class='badge badge-primary'><?php echo $key->file_name ?></span>
                                                                            <span class='badge badge-primary'><?php echo $key->type ?></span>
                                                                            <span class='badge bg-grey-salsa bg-font-grey-salsa'><?php echo date_convert(date('d-m-Y H:i:s', strtotime($key->created_at)), 'd M, Y h:i A') ?></span>
                                                                        </div>
                                                                        <div>
                                                                            <a href="<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name?>" class="btn btn-sm btn-default" title="Download" download><i class="fas fa-download"></i></a>
                                                                            <a class="btn btn-sm btn-default" data-fancybox="images" href="<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name?>"><i class="far fa-eye"></i></a>
                                                                        </div>
                                                                    </li>
                                                                    <?php endif; ?>
                                                                    <?php if($key->user_id != $assign_by && $key->client_approval == 1): ?>
                                                                    <li class="list-group-item" title="<?php echo $key->file_name ?>">
                                                                        <div>
                                                                            <?php if(isset($file['extension']) && in_array($file['extension'], ['jpg', 'png', 'jpeg', 'JPG', 'PNG', 'JPEG'])): ?>
                                                                            <img class='proj_img' src='<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name?>' alt='' width="75">
                                                                            <?php else: ?>
                                                                            <img class='proj_img' src='<?= base_url('/assets/images/default_file_icon.png') ?>' alt='' width="50">
                                                                            <?php endif; ?>
                                                                            <span class='badge badge-primary'><?php echo $key->file_name ?></span>
                                                                            <span class='badge badge-primary'><?php echo $key->type ?></span>
                                                                            <span class='badge bg-grey-salsa bg-font-grey-salsa'><?php echo date_convert(date('d-m-Y H:i:s', strtotime($key->created_at)), 'd M, Y h:i A') ?></span>
                                                                        </div>
                                                                        <div>
                                                                            <a href="<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name?>" class="btn btn-sm btn-default" title="Download" download><i class="fas fa-download"></i></a>
                                                                            <a class="btn btn-sm btn-default" data-fancybox="images" href="<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name?>"><i class="far fa-eye"></i></a>
                                                                        </div>
                                                                    </li>
                                                                    <?php endif; ?>
                                                                <?php else: ?>
                                                                    <?php if(in_array($designation_id,[9])): // only for cad team ?>
                                                                        <?php if($key->visible_cad == 1): ?>
                                                                        <li class="list-group-item" title="<?php echo $key->file_name ?>">
                                                                            <div>
                                                                                <input class='proj_img_chk'  name='project_files_id[]' value='<?php echo $key->project_files_id?>' type='checkbox'>
                                                                                <?php if(isset($file['extension']) && in_array($file['extension'], ['jpg', 'png', 'jpeg', 'JPG', 'PNG', 'JPEG'])): ?>
                                                                                <img class='proj_img' src='<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name?>' alt='' width="75">
                                                                                <?php else: ?>
                                                                                <img class='proj_img' src='<?= base_url('/assets/images/default_file_icon.png') ?>' alt='' width="50">
                                                                                <?php endif; ?>
                                                                                <span class='badge badge-primary'><?php echo $key->file_name ?></span>
                                                                                <span class='badge badge-primary'><?php echo $key->type ?></span>
                                                                                <span class='badge bg-grey-salsa bg-font-grey-salsa'><?php echo date_convert(date('d-m-Y H:i:s', strtotime($key->created_at)), 'd M, Y h:i A') ?></span>
                                                                            </div>
                                                                            <div>
                                                                                <a href="<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name?>" class="btn btn-sm btn-default" title="Download" download><i class="fas fa-download"></i></a>
                                                                                <a class="btn btn-sm btn-default" data-fancybox="images" href="<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name?>"><i class="far fa-eye"></i></a>
                                                                            </div>
                                                                        </li>
                                                                        <?php endif; ?>
                                                                    <?php else:  // other team member  ?>
                                                                    <li class="list-group-item" title="<?php echo $key->file_name ?>">
                                                                        <div>
                                                                            <input class='proj_img_chk'  name='project_files_id[]' value='<?php echo $key->project_files_id?>' type='checkbox'>
                                                                            <?php if(isset($file['extension']) && in_array($file['extension'], ['jpg', 'png', 'jpeg', 'JPG', 'PNG', 'JPEG'])): ?>
                                                                            <img class='proj_img' src='<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name?>' alt='' width="75">
                                                                            <?php else: ?>
                                                                            <img class='proj_img' src='<?= base_url('/assets/images/default_file_icon.png') ?>' alt='' width="50">
                                                                            <?php endif; ?>
                                                                            <span class='badge badge-primary'><?php echo $key->file_name ?></span>
                                                                            <span class='badge badge-primary'><?php echo $key->type ?></span>
                                                                            <span class='badge badge-primary'><?php echo $proj_files_user->name; ?></span> 
                                                                            <span class='badge badge-primary'><?php echo $proj_files_user_des->designation_name ?></span>
                                                                            <span class='badge bg-purple-plum bg-font-purple-plum'><?php echo $key->visible_cad == 1 ? 'Visible To Cad' : 'Hidden to Cad' ?></span>
                                                                            <span class='badge badge-primary'><?php echo $key->client_approval == 1 ? 'Visible' : 'Hidden' ?></span> 
                                                                                
                                                                            <span class='badge bg-grey-salsa bg-font-grey-salsa'><?php echo date_convert(date('d-m-Y H:i:s', strtotime($key->created_at)), 'd M, Y h:i A') ?></span>
                                                                        </div>
                                                                        <div>
                                                                            <a href="<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name?>" class="btn btn-sm btn-default" title="Download" download><i class="fas fa-download"></i></a>
                                                                            <a class="btn btn-sm btn-default" data-fancybox="images" href="<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name?>"><i class="far fa-eye"></i></a>
                                                                            <a class="btn btn-sm btn-default delete_proj_file" data-id="<?= $key->project_files_id ?>"><i class="fas fa-trash-alt"></i></a>
                                                                        </div>
                                                                    </li>
                                                                    <?php endif; ?>
                                                                <?php endif; ?>
                                                            <?php endif; ?>
                                                            <?php endforeach; ?>
                                                        </ul>

                                                        <?php endforeach; ?>


                                                    </form>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end Upload Image -->


                                    <!-- Archive files -->
                                    <?php if(!in_array($designation_id, [5,7,9])): ?>
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <button class="btn collapsed" type="button" data-toggle="collapse" data-target="#archive_files_div" aria-expanded="false">Archive Files</button>
                                        </div>
                                        
                                        <div class="multi-collapse collapse" id="archive_files_div" aria-expanded="false">
                                            <div class="row" style="margin: 20px">
                                                <?php if(in_array($designation_id, [1,6])): ?>
                                                <div class="col-md-12">
                                                    <h4>Archive Files</h4>
                                                    <?php foreach ($project_archive_group as $key1): ?>
                                                    <?php $project_archive_files_by_group = $this->projectmodel->get_project_archive_files_by_group($project->project_id, $key1->project_archive_group_id); ?>
                                                    <div class="groups" style="padding-left: 20px;">
                                                        <h6><?php echo $key1->group_name ?></h6>
                                                        <ul class="list-group" id="archive_files">
                                                            <?php if(count($project_archive_files_by_group) == 0): ?>
                                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                                No Files
                                                            </li>
                                                            <?php else: ?>
                                                            <?php foreach ($project_archive_files_by_group as $key): ?>
                                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                                <span>
                                                                    <img src="<?php echo 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name ?>" width="50" alt="">
                                                                    <?php echo $key->file_name ?>
                                                                    <span class="badge badge-primary"><?php echo $key->type ?></span>
                                                                </span>
                                                                <a data-id="<?php echo $key->project_files_id ?>" class="btn btn-sm btn-circle btn-primary recover_archive">Recover</a>
                                                            </li>
                                                            <?php endforeach ?>
                                                            <?php endif; ?>
                                                        </ul>
                                                    </div>
                                                    <?php endforeach; ?>
                                                    <div class="groups" style="padding-left: 20px;">
                                                        <h6>Ungrouped</h6>
                                                        <ul class="list-group" id="archive_files">
                                                            <?php if(count($project_archive_files) == 0): ?>
                                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                                No Files
                                                            </li>
                                                            <?php else: ?>
                                                            <?php foreach ($project_archive_files as $key): ?>
                                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                                <span>
                                                                    <img src="<?php echo 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name ?>" width="50" alt="">
                                                                    <?php echo $key->file_name ?>
                                                                    <span class="badge badge-primary"><?php echo $key->type ?></span>
                                                                </span>
                                                                <a data-id="<?php echo $key->project_files_id ?>" class="btn btn-sm btn-circle btn-primary recover_archive">Recover</a>
                                                            </li>
                                                            <?php endforeach ?>
                                                            <?php endif; ?>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <?php endif; ?>
                                            </div>
                                        </div>
                                    </div>
                                    <?php endif; ?>
                                    <!-- end Archive files -->


                                    <!-- Print Porject -->
                                    <?php if($client_approval): ?>
                                    <?php if(!in_array($designation_id, [9])): ?>
                                    <div class="panel panel-default"  id="project_print">
                                        <div class="panel-heading">
                                            <button class="btn" type="button" data-toggle="collapse" data-target="#print_project" aria-expanded="true" aria-controls="multiCollapseExample2">Print Project</button>
                                        </div>
                                        <div class="collapse multi-collapse in show" id="print_project">
                                            <div class="row" style="margin: 20px">
                                                <div class="col-md-6">
                                                    <form method="POST" id="update_print_project_form" action="<?php echo base_url('Project_controller/print_project_details')?>" target="_blank">
                                                        <table class="print_table">
                                                            <tbody>
                                                                <tr>
                                                                    <td>Created</td>
                                                                    <td>
                                                                        <!-- Monday, August 27, 2018 -->
                                                                        <?php echo date('l, F d, Y', strtotime($project_details->created_at)) ?>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>Client</td>
                                                                    <td>
                                                                        <?php
                                                                        if($project->asign_user != 0) {
                                                                            $user = $this->db->get_where('user',['id' => $project->asign_user])->row();
                                                                            if($user->designation_id != 7)
                                                                                echo $user->name;
                                                                            else
                                                                                echo $user->company_name.' ('.$user->name.')';
                                                                        }
                                                                        ?><br>
                                                                    </td>
                                                                </tr>
                                                                <!-- <tr>
                                                                    <td>Assignee</td>
                                                                    <td>
                                                                        <select name="project[assignee]" class="form-control">
                                                                            <option value="">Set Assignee</option>
                                                                            <?php foreach ($assignee as $key) : ?>
                                                                            <option value="<?= $key->id ?>"
                                                                                <?php if(isset($project_details->assignee)){
                                                                                echo $project_details->assignee == $key->id ? 'selected' : '';
                                                                                }
                                                                                ?>

                                                                                ><?= $key->name ?></option>
                                                                            <?php endforeach; ?>
                                                                        </select>
                                                                    </td>
                                                                </tr> -->
                                                                <tr>
                                                                    <td>Disposition</td>
                                                                    <td>
                                                                        <?php $disposition_internal = $this->db->query("SELECT * FROM `project_disposition_internal` WHERE project_id = $project->project_id AND flag = 0 ORDER by project_disposition_id DESC")->row();  ?>
                                                                        <?php 
                                                                        if(count($disposition_internal) == 0){
                                                                            $disposition_internal = $this->db->query("SELECT * FROM `project_disposition_internal` WHERE project_id = $project->project_id ORDER by project_disposition_id ASC")->row();
                                                                            if(count($disposition_internal) != 0)
                                                                                echo $this->db->get_where('disposition',['disposition_id' => $disposition_internal->disposition_id])->row()->name;
                                                                        } else{
                                                                            echo $this->db->get_where('disposition',['disposition_id' => $disposition_internal->disposition_id])->row()->name;
                                                                        }

                                                                         ?>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>Priority</td>
                                                                    <td>
                                                                        <select name="project[priority]" class="form-control">
                                                                            <option value="standard" 
                                                                            <?php if(isset($project_details->priority)){
                                                                                echo $project_details->priority == 'standard' ? 'selected' : '';
                                                                                }
                                                                             ?>>Standard Priority</option>
                                                                            <option value="high" 
                                                                            <?php if(isset($project_details->priority)){
                                                                                echo $project_details->priority == 'high' ? 'selected' : '';
                                                                                }
                                                                             ?>>High Priority</option>
                                                                            <option value="critical" 
                                                                            <?php if(isset($project_details->priority)){
                                                                                echo $project_details->priority == 'critical' ? 'selected' : '';
                                                                                }
                                                                             ?>
                                                                            >Critical</option>
                                                                        </select>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>Deadline</td>
                                                                    <td>
                                                                        <input name="project[deadline]" class="form-control" type="text"  value="<?php echo date('m/d/Y', strtotime($project_details->deadline)) ?>" id="print_calendar" <?php echo !$client_approval ? 'disabled' : '' ?>>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>Price 
                                                                        <?php if($project_details->estimated_approve == 1): ?>
                                                                        <br><span class="font-green-meadow"><b>(<?php echo $estimated_approve ?>)</b></span>
                                                                        <?php endif; ?>
                                                                    </td>
                                                                    <td>
                                                                        <input type="number" class="form-control" name="project[price]" value="<?php echo isset($project_details->price) ? $project_details->price : ''?>">
                                                                        <select class="form-control"  name="project[price_type]">
                                                                            <option value="" selected disabled="">Select Price Type</option>
                                                                            <option value="plus_tax" 
                                                                            <?php if(isset($project_details->price_type)){
                                                                                echo $project_details->price_type == 'plus_tax' ? 'selected' : '';
                                                                                }
                                                                             ?>>Plus Tax</option>
                                                                            <option value="includes_tax" 
                                                                            <?php if(isset($project_details->price_type)){
                                                                                echo $project_details->price_type == 'includes_tax' ? 'selected' : '';
                                                                            }
                                                                             ?>>Includes Tax</option>
                                                                            <option value="tax_exempt" 
                                                                            <?php if(isset($project_details->price_type)){
                                                                                echo $project_details->price_type == 'tax_exempt' ? 'selected' : '';
                                                                            }
                                                                             ?>>Tax Exempt</option>
                                                                        </select>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>PO #</td>
                                                                    <td>
                                                                        <input type="text" class="form-control" name="project[po]" value="<?php echo isset($project_details->po) ? $project_details->po : ''?>">
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>Tracking #</td>
                                                                    <td>
                                                                        <input type="text" class="form-control" name="project[tracking]"  value="<?php echo isset($project_details->tracking) ? $project_details->tracking : ''?>">
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td><button class="btn btn-circle btn-md green">Print</button>
                                                                        <button type="button" value="<?php echo $project->project_id?>" id="update_print_project_btn" class="btn btn-circle btn-md green" style="margin-left: 10px">Save</button>
                                                                    </td>
                                                                </tr>
                                                                <input type="hidden" name="project[project_id]" value="<?= $this->uri->segment(3); ?>">
                                                            </tbody>
                                                        </table>
                                                    </form>
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>
                                    <?php endif; ?>
                                    <?php endif; ?>
                                    <!-- end Print Porject -->


                                    <!-- Vendor Print Porject -->
                                    <?php if($client_approval): ?>
                                    <?php if(!in_array($designation_id, [9])): ?>
                                    <div class="panel panel-default"  id="project_vendor_envelope">
                                        <div class="panel-heading">
                                            <button class="btn collapsed" type="button" data-toggle="collapse" data-target="#vendor_envelope_div" aria-expanded="false" aria-controls="multiCollapseExample2">Vendor Envelope</button>
                                        </div>
                                        <div class="collapse multi-collapse" id="vendor_envelope_div" aria-expanded="false">
                                            <div class="row" style="margin: 20px">
                                                <div class="col-md-6">
                                                    <form method="POST" id="update_vendor_envelope_form" action="<?php echo base_url('Project_controller/print_project_details/vendor')?>" target="_blank">
                                                        <table class="print_table">
                                                            <tbody>
                                                                <tr>
                                                                    <td>Created</td>
                                                                    <td>
                                                                        <!-- Monday, August 27, 2018 -->
                                                                        <?php echo date('l, F d, Y', strtotime($project_details->created_at)) ?>
                                                                    </td>
                                                                </tr>

                                                                <tr>
                                                                    <td>Disposition</td>
                                                                    <td>
                                                                        <?php $disposition_internal = $this->db->query("SELECT * FROM `project_disposition_internal` WHERE project_id = $project->project_id AND flag = 0 ORDER by project_disposition_id DESC")->row();  ?>
                                                                        <?php 
                                                                        if(count($disposition_internal) == 0){
                                                                            $disposition_internal = $this->db->query("SELECT * FROM `project_disposition_internal` WHERE project_id = $project->project_id ORDER by project_disposition_id ASC")->row();
                                                                            if(count($disposition_internal) != 0)
                                                                                echo $this->db->get_where('disposition',['disposition_id' => $disposition_internal->disposition_id])->row()->name;
                                                                        } else{
                                                                            echo $this->db->get_where('disposition',['disposition_id' => $disposition_internal->disposition_id])->row()->name;
                                                                        }

                                                                         ?>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>Priority</td>
                                                                    <td>
                                                                        <select name="project[priority]" class="form-control">
                                                                            <option value="standard" 
                                                                            <?php if(isset($project_details->priority)){
                                                                                echo $project_details->priority == 'standard' ? 'selected' : '';
                                                                                }
                                                                             ?>>Standard Priority</option>
                                                                            <option value="high" 
                                                                            <?php if(isset($project_details->priority)){
                                                                                echo $project_details->priority == 'high' ? 'selected' : '';
                                                                                }
                                                                             ?>>High Priority</option>
                                                                            <option value="critical" 
                                                                            <?php if(isset($project_details->priority)){
                                                                                echo $project_details->priority == 'critical' ? 'selected' : '';
                                                                                }
                                                                             ?>
                                                                            >Critical</option>
                                                                        </select>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>Deadline</td>
                                                                    <td>
                                                                        <input name="project[deadline]" class="form-control" type="text"  value="<?php echo date('m/d/Y', strtotime($project_details->deadline)) ?>" id="vendor_calendar" <?php echo !$client_approval ? 'disabled' : '' ?>>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>PO #</td>
                                                                    <td>
                                                                        <input type="text" class="form-control" name="project[po]" value="<?php echo isset($project_details->po) ? $project_details->po : ''?>">
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>Tracking #</td>
                                                                    <td>
                                                                        <input type="text" class="form-control" name="project[tracking]"  value="<?php echo isset($project_details->tracking) ? $project_details->tracking : ''?>">
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td colspan="2"><button class="btn btn-circle btn-md green">Print</button>
                                                                        <button type="button" value="<?php echo $project->project_id?>" id="update_vendor_envelope_btn" class="btn btn-circle btn-md green" style="margin-left: 10px">Save</button>
                                                                    </td>
                                                                </tr>
                                                                <input type="hidden" name="project[project_id]" value="<?= $this->uri->segment(3); ?>">
                                                            </tbody>
                                                        </table>
                                                    </form>
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>
                                    <?php endif; ?>
                                    <?php endif; ?>
                                    <!-- end Vendor Print Porject -->

                                    <!-- Activty Log Porject -->
                                    <?php if($client_approval): ?>
                                    <?php if(!in_array($designation_id, [9])): ?>
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <button class="btn collapsed" type="button" data-toggle="collapse" data-target="#activity_log" aria-expanded="false">Activity Log</button> 
                                            <span class="badge badge-primary pull-right" style="background-color: #337ab7;">Last seen by client <?php echo time_elapsed_string(date_convert(date('d-m-Y H:i:s', strtotime($project_details->last_seen_by_client)), 'Y-M-d H:i:s')); ?></span>
                                        </div>
                                        
                                        <div class="multi-collapse collapse" id="activity_log" aria-expanded="false" style="height: 0px;">
                                            <div class="row" style="margin: 20px">
                                                <div class="col" style="height: 300px; overflow-y: scroll;">
                                                    <table class="table table-borderless">
                                                        <thead>
                                                            <th class="text-center">Last Updated</th>
                                                            <th class="text-center">Updated At</th>
                                                            <th>Updated By</th>
                                                            <th>Update Type</th>
                                                            <th>Details</th>
                                                        </thead>
                                                        <tbody>
                                                            <?php foreach ($project_activity_log as $key) : ?>
                                                            <tr>
                                                                <td class="text-center"><?php echo time_elapsed_string(date_convert(date('d-m-Y H:i:s', strtotime($key->created_at)), 'Y-M-d H:i:s')) ?></td>
                                                                <td class="text-center"><?php echo date_convert(date('d-m-Y H:i:s', strtotime($key->created_at)), 'd M H:i'); ?></td>
                                                                <td>
                                                                    <?php $activity_user = $this->db->get_where('user', ['id' => $key->user_id])->row(); ?>
                                                                    <?php echo $activity_user->name  ?> - 
                                                                    <span class="badge badge-primary"></span><?php echo $this->db->get_where('designation', ['designation_id' => $activity_user->designation_id])->row()->designation_name  ?>
                                                                </td>
                                                                <td><?php
                                                                    // echo $key->activity_type ;
                                                                    if(in_array($key->activity_type, [12,13,14,15,16,31,32,33,44,45])):{
                                                                        echo "Project ".strtolower(str_replace('_', ' ', ($this->db->get_where('activity_type', ['activity_type_id' => $key->activity_type])->row()->activity_name)));
                                                                    }
                                                                    elseif(in_array($key->activity_type, [17,18,19,20,21])): {
                                                                        echo "Project ".strtolower(str_replace('_', ' ', ($this->db->get_where('activity_type', ['activity_type_id' => $key->activity_type])->row()->activity_name)))." specification updated";

                                                                    }
                                                                    elseif(in_array($key->activity_type, [30,46])): {
                                                                        echo "Project ".strtolower(str_replace('_', ' ', ($this->db->get_where('activity_type', ['activity_type_id' => $key->activity_type])->row()->activity_name)))." added";

                                                                    }
                                                                    else: {
                                                                        echo "Project ".strtolower(str_replace('_', ' ', ($this->db->get_where('activity_type', ['activity_type_id' => $key->activity_type])->row()->activity_name)))." updated";
                                                                    }

                                                                    endif;
                                                                ?></td>
                                                                <td>
                                                                    <?php echo $key->details; ?>
                                                                </td>
                                                            </tr>
                                                            <?php endforeach; ?>
                                                            <?php if (count($project_activity_log) == 0) : ?>
                                                            <tr><td class="text-center">No activity yet</td></tr>
                                                            <?php endif; ?>
                                                        </tbody>
                                                    </table>
                                                    
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <?php endif; ?>
                                    <?php endif; ?>
                                    <!-- end activity log -->
                                </div>
                                        
                            </div>
                            <!-- END EXAMPLE TABLE PORTLET-->
                        </div>
                    </div>
                </div>
                <!-- END CONTENT BODY -->
            </div>
                    <!-- END CONTENT -->
        </div>
        <!-- END CONTAINER -->
        <!-- BEGIN FOOTER -->
        <?php include 'inc/footer.php'; ?>
        <!-- END FOOTER -->
    </div>

        

        <!-- disposition change modal -->
        <div class="modal fade" id="change_disposition_modal" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Modal Header</h4>
                    </div>
                    <div class="modal-body">
                        <form id="change_disposition_form" action="">
                            <div class="form-group">
                                <select name="project[disposition_id]" class="form-control" required="">
                                    <option value="">No Disposition Assigned</option>
                                    <?php foreach ($disposition as $key) : ?>
                                    <option value="<?= $key->disposition_id ?>" <?= $project_details->disposition == $key->disposition_id ? 'selected' : ''?>><?= $key->name ?></option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                            <input type="hidden" class="change_disposition_id" name="project[project_disposition_id]" value="">
                            <div class="form-group">
                                <button class="btn">Save</button>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
                
            </div>
        </div>
        <!-- end disposition change modal -->

        <!-- Image Gallery Modal -->
        <div id="myModal" class="modal fade" role="dialog">
            <div class="modal-dialog" style="width: 80%">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Project Image Gallery</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-12">
                                <h4>Cad</h4>
                                <?php foreach ($project_files as $key) : ?>
                                    <?php  if ($key->type == 'cad') : ?>
                                <a href="<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name ?>" data-fancybox="images" data-caption="Backpackers following a dirt trail">
                                    <img src="<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name ?>" width="150" height="130"/>
                                </a>
                                    <?php endif; ?>
                                <?php endforeach; ?>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <h4>Pic</h4>
                                <?php foreach ($project_files as $key) : ?>
                                    <?php  if ($key->type == 'pic') : ?>
                                <a href="<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name ?>" data-fancybox="images" data-caption="Backpackers following a dirt trail">
                                    <img src="<?= 'https://dn95g1jn6e80y.cloudfront.net/'.$key->file_name ?>" width="150" height="130"/>
                                </a>
                                    <?php endif; ?>
                                <?php endforeach; ?>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- internal disposition change modal -->
        <div class="modal fade" id="change_disposition_internal_modal" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Change Internal Disposition</h4>
                    </div>
                    <div class="modal-body">
                        <form id="change_disposition_internal_form" action="">
                            <div class="form-group">
                                <select name="project[disposition_id]" class="form-control" required="">
                                    <option value="">No Disposition Assigned</option>
                                    <?php foreach ($disposition as $key) : ?>
                                    <option value="<?= $key->disposition_id ?>" <?= $project_details->disposition == $key->disposition_id ? 'selected' : ''?>><?= $key->name ?></option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                            <input type="hidden" class="change_disposition_internal_id" name="project[project_disposition_id]" value="">
                            <div class="form-group">
                                <button class="btn">Save</button>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
                
            </div>
        </div>
        <!-- end disposition change modal -->


        <!-- archive group modal -->
       
        <!-- BEGIN CORE PLUGINS -->
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery.min.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/js.cookie.min.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
        <!-- END CORE PLUGINS -->
        <!-- BEGIN PAGE LEVEL PLUGINS -->
        <script src="<?php echo base_url();?>assets/assets/global/plugins/fancybox/source/jquery.fancybox.pack.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-file-upload/js/vendor/jquery.ui.widget.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-file-upload/js/vendor/tmpl.min.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-file-upload/js/vendor/load-image.min.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-file-upload/js/vendor/canvas-to-blob.min.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-file-upload/blueimp-gallery/jquery.blueimp-gallery.min.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-file-upload/js/jquery.iframe-transport.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-file-upload/js/jquery.fileupload.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-file-upload/js/jquery.fileupload-process.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-file-upload/js/jquery.fileupload-image.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-file-upload/js/jquery.fileupload-audio.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-file-upload/js/jquery.fileupload-video.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-file-upload/js/jquery.fileupload-validate.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/global/plugins/jquery-file-upload/js/jquery.fileupload-ui.js" type="text/javascript"></script>
        <!-- END PAGE LEVEL PLUGINS -->
        <!-- BEGIN THEME GLOBAL SCRIPTS -->
        <script src="<?php echo base_url();?>assets/assets/global/scripts/app.min.js" type="text/javascript"></script>
        <!-- END THEME GLOBAL SCRIPTS -->
        <!-- BEGIN PAGE LEVEL SCRIPTS -->
        <script src="<?php echo base_url();?>assets/assets/pages/scripts/form-fileupload.min.js" type="text/javascript"></script>
        <!-- END PAGE LEVEL SCRIPTS -->
        <!-- BEGIN THEME LAYOUT SCRIPTS -->
        <script src="<?php echo base_url();?>assets/assets/layouts/layout/scripts/layout.min.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/layouts/layout/scripts/demo.min.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/layouts/global/scripts/quick-sidebar.min.js" type="text/javascript"></script>
        <script src="<?php echo base_url();?>assets/assets/layouts/global/scripts/quick-nav.min.js" type="text/javascript"></script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
        <!-- END THEME LAYOUT SCRIPTS -->

        <?php if ($this->session->flashdata('cad_progress')): ?>
        <script>
            swal('Project cad progression has changed');
        </script>
        <?php $this->session->unset_userdata('cad_progress'); endif;  ?>


        <script>
            $(document).on('click', '.recover_archive', function(e){
                // var file_id = $(this).val();
                e.preventDefault();
                var file_id = $(this).data('id');
                $.ajax({
                    url: "<?php echo base_url('Project_controller/recover_archive/') ?>"+"/"+file_id,
                    success:function(data){
                        swal('File recovered');
                        setTimeout(function(){
                           location.reload(true);
                        }, 2000);
                    }
                });
            });
        </script>

        <script>
            $(document).ready(function(){
                $(document).on('change', '#wax_only', function(){
                    var wax_only = $(this).val();
                    if(wax_only == 'Resin'){
                        $('#wax_only_resin').show();
                    } else{
                        $("[name='project_specification[wax_only_resin]']").val('');
                        $('#wax_only_resin').hide();
                    }

                });

                $(document).on('change', '#supply_all_gems', function(){
                    var supply_all_gems = $(this).val();
                    if(supply_all_gems == 'Yes'){
                        $('#supply_all_gems_yes').show();
                    } else{
                        $("[name='project_specification[supply_all_gems_yes]']").val('');
                        $('#supply_all_gems_yes').hide();
                    }

                });

                var wax_only = $("[name='project_specification[wax_only]']").val();
                if(wax_only == 'Resin')
                    $('#wax_only_resin').show();
                else
                    $('#wax_only_resin').hide();

                var supply_all_gems = $("[name='project_specification[supply_all_gems]']").val();
                if(supply_all_gems == 'Yes')
                    $('#supply_all_gems_yes').show();
                else
                    $('#supply_all_gems_yes').hide();
            });
        </script>

        <!-- project title leng count -->
        <script>
            $(function(){
                var job_title_cn = $('#job_title').val();
                    $('#job_title_cn').html(job_title_cn.length);
                    $(document).on('keyup', '#job_title', function(){
                    var max_input = 30;
                    var job_title_cn = $('#job_title').val();
                    if(job_title_cn.length <= max_input)
                        $('#job_title_cn').html(job_title_cn.length);
                });
            });
        </script>

        <!-- message form submit -->
        <script>
            $(function(){
                $(document).on('submit','#message_send',function(e){
                    e.preventDefault();
                    var form = $(this).serialize();
                    $.ajax({
                        url: "<?= site_url('Project_controller/insert_msg') ?>",
                        data: form,
                        type: 'post',
                        success:function(data){
                            if(!$('#messaging').hasClass("show"))
                                $('#messaging_id').trigger('click');
                            // $("#msg_tbody").html(data);
                            $("input[name='msg']").val('');
                            $("[name='msg_to']").val('');
                            swal("Message added");
                            setTimeout(function(){
                               location.reload(true);
                            }, 2000);
                        }
                    });
                });
            });
        </script>

        <?php if ($this->session->flashdata('project_insert')) : ?>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
        <script>
            jQuery.noConflict();
            (function ($){
                // swal("Good job!", "One Job Added", "success");
                swal("Uploaded successfully")
                .then((value) => {
                  window.location.href = "<?php echo base_url() ?>";
                });

                swal({
                  text: "Uploaded successfully",
                  buttons: true,
                  buttons: ["Cancel", "Go to dashboard"],
                })
                .then((willDelete) => {
                  if (willDelete) {
                        window.location.href = "<?php echo base_url() ?>";
                  } else {
                  }
                });
            })(jQuery);
        </script>
        <?php endif; ?>

        <script>
            $(document).ready(function() {
                $('#Add').click(function() {
                    var disposition = $('#disposition').val();
                    var project_id = '<?= $this->uri->segment(3); ?>';
                    if (disposition != 0) {
                        $.ajax({
                            url: "<?= site_url('Project_controller/insert_disposition') ?>",
                            type: 'POST',
                            data: {
                                'project_id': project_id,
                                'disposition': disposition
                            },
                            success: function(data) {
                                if (data == 'false')
                                    swal("Disposition already added", {
                                        dangerMode: true,
                                    });
                                else {
                                    swal('Disposition Added');
                                    $('#project_disposition_steps #project_dispositions_main').html(data);
                                }
                            }
                        });
                    }
                });

                $(document).on('click', '.update_disposition', function() {
                    var project_disposition_id = $(this).val();
                    $.ajax({
                        url: "<?= site_url('Project_controller/update_disposition') ?>" + "/" + project_disposition_id,
                        success: function(data) {
                            swal('Disposition Updated');
                            $('#project_disposition_steps #project_dispositions_main').html(data);
                        }
                    });
                });
                $(document).on('click', '.change_disposition', function() {
                    var project_disposition_id = $(this).val();
                    $('.change_disposition_id').val(project_disposition_id);
                });
                $(document).on('click', '.delete_disposition', function() {
                    var project_disposition_id = $(this).val();
                    $.ajax({
                        url: "<?= site_url('Project_controller/delete_disposition') ?>" + "/" + project_disposition_id,
                        success: function(data) {
                            // alert(data);
                            swal('Disposition Updated');
                            $('#project_disposition_steps #project_dispositions_main').html(data);
                        }
                    });

                });
                $(document).on('submit', '#change_disposition_form', function(e) {
                    e.preventDefault();
                    var form = $(this).serialize();
                    $.ajax({
                        url: "<?= site_url('Project_controller/change_disposition') ?>",
                        data: form,
                        type: 'post',
                        success: function(data) {
                            // alert(data);
                            $('#change_disposition_modal').modal('hide');
                            swal('Disposition Updated');
                            $('#project_disposition_steps #project_dispositions_main').html(data);
                        }
                    });
                });
                $(document).on('click', '.revert', function() {
                    var project_disposition_id = $(this).val();
                    $.ajax({
                        url: "<?= site_url('Project_controller/revert_disposition') ?>" + "/" + project_disposition_id,
                        success: function(data) {
                            swal('Disposition Updated');
                            $('#project_disposition_steps #project_dispositions_main').html(data);
                        }
                    });

                });
            });
        </script>

        <script>
            /*$('[data-fancybox="images"]').fancybox({
                buttons : [
                    'close'
                ]
            });*/
        </script>

        <script>
            $(document).ready(function() {
                $('#add_disposition_internal').click(function() {
                    var disposition = $('#disposition_internal').val();
                    var project_id = '<?= $this->uri->segment(3); ?>';
                    if (disposition != 0) {
                        $.ajax({
                            url: "<?= site_url('Project_controller/insert_disposition_internal') ?>",
                            type: 'POST',
                            data: {
                                'project_id': project_id,
                                'disposition': disposition
                            },
                            success: function(data) {
                                if (data == 'false')
                                    swal("Disposition already added", {
                                        dangerMode: true,
                                    });
                                else {
                                    swal('Disposition Added');
                                    $('#project_disposition_internal_steps').html(data);
                                }
                            }
                        });
                    }
                });
                $(document).on('click', '.update_disposition_internal', function() {
                    var project_disposition_id = $(this).val();
                    $.ajax({
                        url: "<?= site_url('Project_controller/update_disposition_internal') ?>" + "/" + project_disposition_id,
                        success: function(data) {
                            swal('Disposition Updated');
                            $('#project_disposition_internal_steps').html(data);
                        }
                    });
                });
                $(document).on('click', '.change_disposition_internal', function() {
                    var project_disposition_id = $(this).val();
                    $('.change_disposition_internal_id').val(project_disposition_id);
                });
                $(document).on('click', '.delete_disposition_internal', function() {
                    var project_disposition_id = $(this).val();
                    $.ajax({
                        url: "<?= site_url('Project_controller/delete_disposition_internal') ?>" + "/" + project_disposition_id,
                        success: function(data) {
                            // alert(data);
                            swal('Disposition Updated');
                            $('#project_disposition_internal_steps').html(data);
                        }
                    });

                });
                $(document).on('submit', '#change_disposition_internal_form', function(e) {
                    e.preventDefault();
                    var form = $(this).serialize();
                    $.ajax({
                        url: "<?= site_url('Project_controller/change_disposition_internal') ?>",
                        data: form,
                        type: 'post',
                        success: function(data) {
                            // alert(data);
                            $('#change_disposition_internal_modal').modal('hide');
                            swal('Disposition Updated');
                            $('#project_disposition_steps #project_dispositions_main').html(data);
                        }
                    });
                });
                $(document).on('click', '.revert_internal', function() {
                    var project_disposition_id = $(this).val();
                    $.ajax({
                        url: "<?= site_url('Project_controller/revert_disposition_internal') ?>" + "/" + project_disposition_id,
                        success: function(data) {
                            swal('Disposition Updated');
                            $('#project_disposition_internal_steps').html(data);
                        }
                    });

                });
            });
        </script>
       

        <script>
            $('#print_project').collapse('show');
            $(document).on('click', '#update_print_project_btn', function(){
                var form = $('#update_print_project_form').serialize();
                var project_id = $(this).val();
                $.ajax({
                    url: '<?php echo base_url('Project_controller/update_print_project_details')?>',
                    data: form,
                    type: 'post',
                    success:function(data) {
                        // alert(data);
                        swal('Updated');
                        setTimeout(function(){
                            location.reload();
                        }, 2000);
                    }

                });
            });
            $(document).on('click', '#update_vendor_envelope_btn', function(){
                var form = $('#update_vendor_envelope_form').serialize();
                var project_id = $(this).val();
                $.ajax({
                    url: '<?php echo base_url('Project_controller/update_print_project_details')?>',
                    data: form,
                    type: 'post',
                    success:function(data) {
                        // alert(data);
                        swal('Updated');
                        setTimeout(function(){
                            location.reload();
                        }, 2000);
                    }

                });
            });
        </script>

        <?php if(isset($_SERVER['HTTP_REFERER'])): ?>
        <?php if($_SERVER['HTTP_REFERER']  == base_url('Master_controllers/dashboard')): ?>
        <script>
            $('#messaging').collapse('show');
        </script>
        <?php endif; ?>
        <?php endif; ?>


        <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.1/js/plugins/piexif.min.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.1/js/plugins/sortable.min.js" type="text/javascript"></script>
        <script src="<?php echo base_url('assets/file_input/fileinput.js')?>" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.1/themes/fas/theme.min.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.1/themes/explorer-fas/theme.min.js" type="text/javascript"></script>
        <script>
            jQuery.noConflict();

            (function($){
                // var type = $('.file_input_type').val();
                // var type = document.getElementByClassName('.file_input_type');
                // $(document).on('change', '.file_input_type', function(){
                //     var type = $(this).val();
                //     alert(type);
                // });
                // alert(type);
                $("#file-1").fileinput({
                    theme: 'explorer-fas',
                    uploadUrl:  "<?php echo base_url('Project_controller/krajee_upload/'.$project->project_id.'/')?>"+"/"+'cad',
                    uploadAsync: true,
                    overwriteInitial: false,
                    fileActionSettings: {
                        showDrag: false,
                    },
                    minFileCount: 1,
                    maxFileCount: 5,
                    // showPreview :false,
                    showUploadedThumbs: false,
                    initialPreviewShowDelete: false,
                    initialPreviewAsData: true, // identify if you are sending preview data only and not the markup
                    previewFileIcon: '<i class="fas fa-file"></i>',
                    allowedPreviewTypes: null,
                    
                });

                $('#file-1').on('filebatchselected', function(event, numFiles, label) {
                    setTimeout(function(){
                    swal('Please click the upload button to upload');
                    }, 1000);
                });

                $('#file-1').on('filebatchuploadcomplete', function(event, preview, config, tags, extraData) {
                    console.log('File batch upload complete', preview, config, tags, extraData);
                    setTimeout(function(){
                       location.reload(true);
                    }, 2000);
                });

                $("#file-2").fileinput({
                    theme: 'explorer-fas',
                    uploadUrl:  "<?php echo base_url('Project_controller/krajee_upload/'.$project->project_id.'/')?>"+"/"+'pic',
                    uploadAsync: true,
                    overwriteInitial: false,
                    fileActionSettings: {
                        showDrag: false,
                    },
                    minFileCount: 1,
                    maxFileCount: 5,
                    // showPreview :false,
                    initialPreviewShowDelete: false,
                    initialPreviewAsData: true, // identify if you are sending preview data only and not the markup
                    
                });

               $('#file-2').on('fileuploaded', function(event, previewId, index, fileId) {
                    setTimeout(function(){
                       location.reload(true);
                    }, 2000);
                });

               $('#file-2').on('filebatchselected', function(event, numFiles, label) {
                    setTimeout(function(){
                    swal('Please click the upload button to upload');
                    }, 1000);
                });
            })(jQuery);
        </script>

        <script>
            $('#reply_send').hide();

            $(document).on('click', '.reply', function(){
                var project_msg_id = $(this).val();
                $('#message_send').hide();
                $('#reply_send').show();
                $("#project_msg_id").val(project_msg_id);

                $('#create_msg').collapse('show');

            });
            $(document).on('click', '#reply_btn', function(){
                $('#message_send').show();
                $('#reply_send').hide();
            });
        </script>

        <script>
            $(function(){
                $(document).on('submit','#reply_send',function(e){
                    e.preventDefault();
                    var form = $(this).serialize();
                    $.ajax({
                        url: "<?= site_url('Project_controller/insert_reply') ?>",
                        data: form,
                        type: 'post',
                        success:function(data){
                            // alert(data);
                            // if(!$('#messaging').hasClass("show"))
                            //     $('#messaging_id').trigger('click');
                            // $("#msg_tbody").html(data);
                            // $("input[name='msg']").val('');
                            // $("[name='msg_to']").val('');
                            swal("Message added");
                            location.reload();
                        }
                    });
                });
            });
        </script>

        <script>
            $(document).on('click', '.desc_approval_btn', function(){
                var id = $(this).val();
                $.ajax({
                    url: "<?php echo base_url('Project_controller/desc_permission/')?>"+"/"+id,
                    success:function(data){
                        swal("Project description approved.")
                        .then((value) => {
                          location.reload();
                        });
                    }
                });
            });

            $(document).on('click', '.spec_approval_btn', function(){
                var id = $(this).val();
                $.ajax({
                    url: "<?php echo base_url('Project_controller/spec_permission/')?>"+"/"+id,
                    success:function(data){
                        swal("Project specification approved.")
                        .then((value) => {
                          location.reload();
                        });
                    }
                });
            });
        </script>

        <script>
            $(document).on('click', '#reset_all_disposition', function(){
                var id = $(this).val();
                swal({
                  title: "Are you sure?",
                  buttons: true,
                  dangerMode: true,
                })
                .then((willDelete) => {
                  if (willDelete) {
                    $.ajax({
                        url: "<?= site_url('Project_controller/reset_all_disposition') ?>"+"/"+id,
                        success:function(data){
                            swal('Disposition reset');
                            $('#project_disposition_steps #project_dispositions_main').html(data);
                        }
                    });
                  }
                });

            });
        </script>
       

        

        <script>
            $(document).on('click', '.disposition_more', function(e){
                e.preventDefault();
                var val = $(this).data('value');
                swal({
                  title: "Are you sure?",
                  buttons: true,
                  dangerMode: true,
                })
                .then((willDelete) => {
                  if (willDelete) {
                    $.ajax({
                        url: "<?php echo base_url('Project_controller/disposition_change_option/'.$project->project_id.'/') ?>"+"/"+val,
                        success:function(data){
                            $('#project_disposition_steps #project_dispositions_main').html(data);
                            swal("Disposition updated");
                        }
                    });
                  }
                });
            });
        </script>

        <script>
            // $('#archive_groups').hide();
            $(document).on('change', '#file_action', function(){
                var action = $(this).val();
                if(action == 'archive')
                    $('#archive_groups').removeAttr('disabled');
                else
                    $('#archive_groups').attr('disabled', 'disabled');
            });

            $(document).on('click', '#add_archive_group', function(){
                swal("Enter group name:", {
                    content: "input",
                    // closeOnClickOutside: false,
                    showCancelButton: true,
                    cancelButtonText: "No",
                    showCloseButton: true,

                })
                .then((value) => {
                    if(value === '' || value === null)
                        swal('Please enter a name');
                    else{
                        var project_id = <?php echo $project->project_id ?>;
                        var group_name = encodeURIComponent(value);
                        $.ajax({
                            url: "<?php echo base_url('Project_controller/add_archive_group/') ?>"+"/"+project_id+"/"+group_name,
                            success:function(data){
                                swal('Group added');
                                setTimeout(function(){
                                    location.reload();
                                }, 1000);
                            }
                        });
                    }

                });
            });
        </script>

        <script>
            $(document).on('click', '.delete_proj_file', function(e){
                e.preventDefault();
                var val = $(this).data('id');
                swal({
                  title: "Are you sure?",
                  buttons: true,
                  dangerMode: true,
                })
                .then((willDelete) => {
                  if (willDelete) {
                    $.ajax({
                        url: "<?php echo base_url('Project_controller/delete_krajee_img/') ?>"+"/"+val,
                        success:function(data){
                            swal("File deleted");
                            setTimeout(function(){
                                location.reload();
                            }, 1000);
                        }
                    });
                  }
                });
            });
        </script>
            
        

        <!-- deadline calender scripts -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
        <script>
            jQuery.noConflict();
            
            (function($){
                // An array of dates
                var criticalDates = {};
                var rushDates = {};
                var standardDates = {};


                <?php 
                $critical_begin = new DateTime(date('m/d/Y',strtotime($project_details->created_at)));
                $critical_end   = new DateTime(date('m/d/Y',strtotime($project_details->created_at. ' +3 day')));

                for($i = $critical_begin; $i <= $critical_end; $i->modify('+1 day')): ?>
                criticalDates[ new Date( '<?php echo $i->format("m/d/Y") ?>' )] = new Date( '<?php echo $i->format("m/d/Y") ?>' );
                <?php endfor; ?>

                <?php 
                $rush_begin = new DateTime(date('m/d/Y',strtotime($project_details->created_at. ' +4 day')));
                $rush_end   = new DateTime(date('m/d/Y',strtotime($project_details->created_at. ' +7 day')));

                for($i = $rush_begin; $i <= $rush_end; $i->modify('+1 day')): ?>
                rushDates[ new Date( '<?php echo $i->format("m/d/Y") ?>' )] = new Date( '<?php echo $i->format("m/d/Y") ?>' );
                <?php endfor; ?>

                <?php 
                $standard_begin = new DateTime(date('m/d/Y',strtotime($project_details->created_at. ' +8 day')));
                $standard_end   = new DateTime(date('m/d/Y',strtotime($project_details->created_at. ' +12 day')));

                for($i = $standard_begin; $i < $standard_end; $i->modify('+1 day')): ?>
                standardDates[ new Date( '<?php echo $i->format("m/d/Y") ?>' )] = new Date( '<?php echo $i->format("m/d/Y") ?>' );
                <?php endfor; ?>

          
                
                // datepicker
                jQuery('#calendar').datepicker({
                    minDate: '<?php echo date('m/d/Y',strtotime($project_details->created_at)) ?>',
                    beforeShowDay: function( date ) {
                        var highlightCritical = criticalDates[date];
                        var highlightRush = rushDates[date];
                        var highlightStandard = standardDates[date];
                      if( highlightRush ) {
                             return [true, "rushDates", highlightRush];
                        } else if( highlightCritical ) {
                             return [true, "criticalDates", highlightCritical];
                        } else if( highlightStandard ) {
                             return [true, "standardDates", highlightStandard];
                        } else {
                             return [true, '', ''];
                        }
                       
                     }
                });
                jQuery('#print_calendar').datepicker({
                    minDate: '<?php echo date('m/d/Y',strtotime($project_details->created_at)) ?>',
                    beforeShowDay: function( date ) {
                        var highlightCritical = criticalDates[date];
                        var highlightRush = rushDates[date];
                        var highlightStandard = standardDates[date];
                      if( highlightRush ) {
                             return [true, "rushDates", highlightRush];
                        } else if( highlightCritical ) {
                             return [true, "criticalDates", highlightCritical];
                        } else if( highlightStandard ) {
                             return [true, "standardDates", highlightStandard];
                        } else {
                             return [true, '', ''];
                        }
                       
                     }
                });

                jQuery('#vendor_calendar').datepicker({
                    minDate: '<?php echo date('m/d/Y',strtotime($project_details->created_at)) ?>',
                    beforeShowDay: function( date ) {
                        var highlightCritical = criticalDates[date];
                        var highlightRush = rushDates[date];
                        var highlightStandard = standardDates[date];
                      if( highlightRush ) {
                             return [true, "rushDates", highlightRush];
                        } else if( highlightCritical ) {
                             return [true, "criticalDates", highlightCritical];
                        } else if( highlightStandard ) {
                             return [true, "standardDates", highlightStandard];
                        } else {
                             return [true, '', ''];
                        }
                       
                     }
                });

                jQuery('#internal_deadline_calendar').datepicker({
                    minDate: '<?php echo date('m/d/Y',strtotime($project_details->created_at)) ?>'
                });
            })(jQuery);
        </script>
        <!-- end deadline calender scripts -->
        
        <!-- slot datepicker scripts -->

        <script>
            jQuery(document).ready(function($) {
                $('.slot-datepicker').bind('keypress', function(e) {
                    e.preventDefault(); 
                });
                $('.slot-datepicker').bind('keydown', function(e) {
                    e.preventDefault(); 
                });
                $('.3d-print-datepicker').bind('keypress', function(e) {
                    e.preventDefault(); 
                });
                $('.3d-print-datepicker').bind('keydown', function(e) {
                    e.preventDefault(); 
                });
            });
        </script>

        <script>
            jQuery.noConflict();

            (function($){
                $(document).on('mouseenter', '.slot-datepicker', function(){
                    var slot_inp = $(this);
                    var user_id = $(this).data('user');
                    var criticalCadDates = {};
                    var rushCadDates = {};
                    var standardCadDates = {};

                    $.ajax({
                        url: "<?php echo base_url('User_controller/get_cad_slot_dates_by_status/') ?>"+user_id,
                        dataType: "json",
                        success:function(data) {
                            for (x in data.full_dates) {
                                criticalCadDates[ new Date( "'"+data.full_dates[x]+"'" )] = new Date( "'"+data.full_dates[x]+"'"  );
                            }
                            for (x in data.warning_dates) {
                                rushCadDates[ new Date( "'"+data.warning_dates[x]+"'" )] = new Date( "'"+data.warning_dates[x]+"'"  );
                            }
                            for (x in data.available_dates) {
                                standardCadDates[ new Date( "'"+data.available_dates[x]+"'" )] = new Date( "'"+data.available_dates[x]+"'"  );
                            }
                        }
                    });

                    $(this).datepicker({
                        minDate: '<?php echo date('m/d/Y',strtotime($project_details->created_at)) ?>',
                        onSelect: function(dateText, inst) {
                            var date = $(this).val();
                            var user_id = $(this).data('user');
                            $.ajax({
                                url: "<?php echo base_url('User_controller/check_slot_availability/') ?>"+user_id,
                                data: {'date': date},
                                type: "POST",
                                success:function(data){
                                    if(data == 'vacation'){
                                        swal("User have a vacation on this date please choose another.");
                                        $(slot_inp).val('');
                                    } else if(data <= 0){
                                        swal("No slot availible. Pick another date");
                                        $(slot_inp).val('');
                                    } else{
                                        var str = data+' slot availible on this date '+date;
                                        swal(str);
                                    }
                                }
                            });
                        },
                        beforeShowDay: function( date ) {
                            var highlightCritical = criticalCadDates[date];
                            var highlightRush = rushCadDates[date];
                            var highlightStandard = standardCadDates[date];

                            if( highlightRush ) {
                                 return [true, "rushDates", highlightRush];
                            } else if( highlightCritical ) {
                                 return [true, "criticalDates", highlightCritical];
                            } else if( highlightStandard ) {
                                 return [true, "standardDates", highlightStandard];
                            } else {
                                 return [true, '', ''];
                            }
                           
                         }
                    });
                });  
                $(document).on('focus', '.3d-print-datepicker', function(){
                    $(this).datepicker({
                        minDate: '<?php echo date('m/d/Y',strtotime($project_details->created_at)) ?>',
                    });
                });  
            })(jQuery);
        </script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
        <script>
            jQuery.noConflict;

            (function($){
                $('#project_assignee').select2();
                $('#project_assignee').on('select2:select', function (e) {
                    var data = e.params.data;
                    console.log(data);
                    $.ajax({
                        url: "<?php echo base_url('User_controller/check_des/') ?>"+data.id,
                        success:function(res){
                            if(res == '1'){
                                $('#cad_slot_date_div').append('<div class="form-group" id="cad_slot_date_single_div'+data.id+'"><div class="col-md-2"><span class="badge badge-primary">'+data.text+'</span></div><div class="col-md-4"><input type="text" class="form-control slot-datepicker" data-user="'+data.id+'" name="cad_slot_date['+data.id+']" placeholder="Select cad date" autocomplete="off"></div><div class="col-md-1"><a class="btn btn-sm btn-circle btn-default cad_slots_modal_btn" target="_blank" href="<?php echo base_url('cad_slots/') ?>'+data.id+'">Cad Slot</a></div><div class="col-md-4"><input type="text" class="form-control 3d-print-datepicker" data-user="'+data.id+'" name="cad_3d_print_date['+data.id+']" placeholder="Select 3d print date" autocomplete="off"></div></div>');
                            }

                        }
                    });
                });
                $('#project_assignee').on('select2:unselect', function (e) {
                    var data = e.params.data;
                    $('#cad_slot_date_single_div'+data.id).remove();
                });
                $('#msg_user').select2();
                $('#archive_groups').select2({
                    placeholder: "Select Group"
                });
            })(jQuery);
        </script>

        <!-- end slot datepicker scripts -->
        
        <!-- note script -->
        <script>
            $(document).on('submit', '#create_note_form', function(e){
                e.preventDefault();
                var form = $(this).serialize();
                $('#create_note_form input[name="note[note]"]').val('');
                $.ajax({
                    url: "<?php echo base_url('Project_controller/create_note/') ?>",
                    data: form,
                    type: 'POST',
                    success:function(data){
                        swal('Note addded')
                        $("#notes_table").load(location.href + ' #notes_table');
                    }
                });
            });  
        </script>
        <script>
            $(document).on('click', '.delete_note', function(){
                var note_id = $(this).val();
                $.ajax({
                    url: "<?php echo base_url('Project_controller/delete_note/') ?>"+note_id,
                    success:function(data){
                        swal('Note deleted')
                        $("#notes_table").load(location.href + ' #notes_table');
                    }
                });
            });
        </script>
        <script>
            $(document).on('click', '.send_quote', function(){
                $.ajax({
                	url: "<?php echo base_url('Project_controller/send_estimate_email/'.$project->project_id) ?>",
                	success:function(data){
                		swal('Quote sent successfully');
                	}
                });
            });
        </script>
        <!-- end note script -->

    </body>
</html>
<?php //$endtime = microtime(true); 
// printf("Page loaded in %f seconds", $endtime - $starttime );
?>
